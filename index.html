<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ§ÙƒØ³ÙŠ Ø§Ù„Ø°ÙƒÙŠ</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        :root {
            --primary-color: #00CED1;
            --secondary-color: #2E2E2E;
            --accent-color: #FFA500;
            --bg-color: #1A1A1A;
			 --neon-glow: 0 0 15px var(--primary);  /* ØªØ£Ø«ÙŠØ± Ø¥Ø¶Ø§Ø¡Ø© */
             --gradient: linear-gradient(135deg, var(--primary) 0%, #4FACFE 100%);
        }

        * {
            box-sizing: border-box;
            font-family: 'Tajawal', sans-serif;
            margin: 0;
            padding: 0;
        }

        html, body {
		 	  margin: 0 !important;
             padding: 0 !important;
           overflow: hidden;
             width: 100%;
           height: 100%;
		     background: #000; /* Ù„ÙˆÙ† Ø§Ù„Ø®Ù„ÙÙŠØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© */
        }

        body {
            background: var(--bg-);
            color: var(--text);
		    position: relative;
             min-height: 100vh;
			   overflow-x: hidden;
        }

        .control-panel {
            position: fixed;
            top: 0px;
            left: 0px;
            right: 0px;
            z-index: 1000;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
		    z-index: 1000 !important;
	        flex-direction: row;
            justify-content: space-between;
            align-items: flex-start;
        }

        .input-field {
		  flex: 1;
  min-width: 280px;
  background: var(--glass-bg);
  border-radius: 15px;
  padding: 1rem;
  position: relative;
  transform-style: preserve-3d;
        }

        .input-field input {
            width: 100%;
            padding: 10px;
            border: 2px solid var(--primary-color);
            border-radius: 6px;
            background: #121212;
            color: #FFF;
            font-size: 16px;
            outline: none;
            transition: border-color 0.3s;
        }

        .input-field input:focus {
            border-color: var(--accent-color);
			
        }

        .action-buttons {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            display: flex;
            gap: 15px;
            padding: 15px;
            border-radius: 8px;
			z-index: 1000 !important;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            background: var(--primary-color);
            color: var(--secondary-color);
            min-width: 150px;
            font-size: 16px;
			  /* Ø§Ù„ØªØ¯Ø±Ø¬ Ø§Ù„Ù„ÙˆÙ†ÙŠ */
  background: linear-gradient(135deg, #FFD700, #D4AF37);
  color: #000;
  
  /* Ø§Ù„Ø¸Ù„ */
  transform: perspective(500px) rotateX(15deg);
  box-shadow: 0 20px 40px rgba(0,0,0,0.3);
  /* Ø§Ù„ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ© */
  position: relative;
  overflow: hidden;
        }

/* ØªØ£Ø«ÙŠØ± Ø§Ù„Ø¥Ø¶Ø§Ø¡Ø© Ø¹Ù†Ø¯ Ø§Ù„ØªØ­ÙˆÙŠÙ… */
.btn::after {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(
    90deg,
    transparent,
    rgba(255, 255, 255, 0.25),
    transparent
  );
  transition: 0.75s;
}
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 206, 209, 0.4);
        }
.btn:hover::after {
  left: 100%;
}
/* Ø£Ø²Ø±Ø§Ø± Ù…Ø¹ Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª */
.btn-icon {
  display: inline-flex;
  align-items: center;
  gap: 12px;
  padding: 12px 28px;
}

.btn-icon i {
  font-size: 1.1em;
  transition: transform 0.3s ease;
}

.btn-icon:hover i {
  transform: translateX(5px);
}

/* Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„ */
.btn-loading {
  position: relative;
  pointer-events: none;
}

.btn-loading::after {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 24px;
  height: 24px;
  border: 3px solid rgba(255, 255, 255, 0.3);
  border-top-color: #fff;
  border-radius: 50%;
  animation: spin 1s linear infinite;
  transform: translate(-50%, -50%);
}

@keyframes spin {
  to { transform: translate(-50%, -50%) rotate(360deg); }
}
        #map {
  height: 65vh;
  width: 90%;
  margin: 6rem auto 2rem;
  border-radius: 20px;
  overflow: hidden;
  border: 1.5px solid var(--primary);
  box-shadow:
    0 0 20px var(--primary),
    0 8px 24px rgba(0, 0, 0, 0.5);
  backdrop-filter: blur(6px);
  transition: all 0.3s ease-in-out;
}
.gm-style .gm-style-iw-c {
    background: #0a1a30 !important;
    color: #aec9d1 !important;
    border-radius: 12px !important;
    box-shadow: 0 5px 15px rgba(0,0,0,0.4) !important;
}

.gm-style .gm-style-iw-t::after {
    background: #0a1a30 !important;
}
        .route-info {
            position: fixed;
            top: 120px;
            left: 20px;
            background: rgba(46, 46, 46, 0.9);
            padding: 20px;
            border-radius: 8px;
            z-index: 1000;
            max-width: 300px;
            backdrop-filter: blur(5px);
			    display: none !important; /* Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù‚Ø³Ù… ØªÙ…Ø§Ù…Ù‹Ø§ */

        }

        /* ØªØµÙ…ÙŠÙ… Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
/* ØªÙ†Ø³ÙŠÙ‚ Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© */
.price-options {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    width: 100vw; /* ØªØºØ·ÙŠØ© Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„ÙƒØ§Ù…Ù„ */
    height: 35vh; /* Ø§Ø±ØªÙØ§Ø¹ Ù…Ù†Ø§Ø³Ø¨ Ù„Ù„Ø´Ø§Ø´Ø© */
    background: rgba(15, 15, 15, 0.98);
    backdrop-filter: blur(15px);
    border-top: 1px solid rgba(255,255,255,0.1);
    box-shadow: 0 -8px 30px rgba(0,0,0,0.3);
    overflow-x: auto;
    overflow-y: hidden;
    gap: 15px;
    padding: 15px;
    scroll-snap-type: x mandatory;
    z-index: 1000;
    transform: none !important;
}

/* ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ù„Ø¹Ø±Ø¶Ù‡Ø§ Ø¨Ø´ÙƒÙ„ Ø£ÙÙ‚ÙŠ */
.price-option {
    scroll-snap-align: center;
    flex: 0 0 85%;
    min-width: 85%;
    height: 80%;
    padding: 20px;
    border-radius: 15px;
    background: rgba(30, 30, 30, 0.95);
    border: 1px solid rgba(255,255,255,0.1);
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    transition: all 0.3s ease;
    overflow: hidden;
}

/* ØªØ­Ø³ÙŠÙ† Ø§Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ */
.price-option h3 {
    font-size: 1.2rem;
    margin-bottom: 10px;
    white-space: nowrap;
}

.price-option .total-price {
    font-size: 1.8rem;
    margin: 15px 0;
}

/* Ø¥ØµÙ„Ø§Ø­ Ù…Ø´ÙƒÙ„Ø© Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø§Ù„Ø£ÙÙ‚ÙŠ */
.price-options::-webkit-scrollbar {
    height: 4px;
}

.price-options::-webkit-scrollbar-thumb {
    background: rgba(0,206,209,0.8);
    border-radius: 2px;
}
/* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© */
@media (max-width: 768px) {
    .price-options {
        display: grid;
        grid-template-columns: repeat(3, 1fr); /* 3 Ø£Ø¹Ù…Ø¯Ø© Ù…ØªØ³Ø§ÙˆÙŠØ© */
        gap: 8px;
        height: 22vh; 
        padding: 8px;
        overflow: visible;
        box-shadow: none;
        border-top: none;
		    bottom: 25vh; /* Ø±ÙØ¹ Ø§Ù„Ø­Ø§ÙˆÙŠØ© 25% Ù…Ù† Ø£Ø³ÙÙ„ Ø§Ù„Ø´Ø§Ø´Ø© */

    }

    .price-option {
        flex: 1;
        min-width: auto;
        height: auto;
        padding: 8px;
        border-radius: 10px;
        scroll-snap-align: none;
    }

    .price-option h3 {
	    color: #ffffff !important; /* Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø¨ÙŠØ¶ */
    text-shadow: 0 1px 3px rgba(0,0,0,0.3);

        font-size: 0.9rem;
        flex-direction: column;
        gap: 4px;
    }

    .vehicle-icon {
        font-size: 1.2rem;
    }

    .total-price {
        font-size: 1rem;
        margin: 8px 0;
    }

    .vehicle-details-short {
        display: none;
    }
}

/* ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© Ø¬Ø¯Ù‹Ø§ */
@media (max-width: 480px) {
    .price-options {
        grid-template-columns: 1fr; /* Ø¹Ù…ÙˆØ¯ ÙˆØ§Ø­Ø¯ */
        gap: 6px;
    }
    
    .price-option {
        width: 100%;
        padding: 10px;
    }
    
    .price-option h3 {
        font-size: 0.85rem;
    }
    
    .total-price {
        font-size: 0.9rem;
    }
}
.gm-style-iw-c {
    box-shadow: 0 0 20px rgba(0, 206, 209, 0.5) !important;
    border-radius: 15px !important;
    background: linear-gradient(145deg, #0a1a30, #0d2342) !important;
}

.gm-style .gm-style-iw-t::after {
    background: linear-gradient(145deg, #0a1a30, #0d2342) !important;
    box-shadow: -5px -5px 15px rgba(10, 26, 48, 0.5),
                5px 5px 15px rgba(0, 0, 0, 0.3) !important;
}
        .price-option:hover {
            transform: scale(1.05);
        }

        .price-option.selected {
    background: rgba(46, 46, 46, 0.7) !important; /* Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø´ÙØ§ÙÙŠØ© */
            color: var(--secondary-color);
            box-shadow: 0 4px 15px rgba(0, 206, 209, 0.4);
        
		}

        .booking-details {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -20%);
		      background: rgba(255, 255, 255, 0.05) !important; /* Ø´ÙØ§ÙÙŠØ© 90% */
            padding: 10px;
            border-radius: 8px;
            z-index: 2000;
            display: none;
            text-align: center;
            backdrop-filter: blur(15px);
            width: 100%;
            max-width: 90%;
			
        }
		.booking-details h2 {
        font-size: 1.1rem !important;
        margin-bottom: 5px !important;
    }

    .booking-details p {
        font-size: 0.75rem !important;
        margin: 3px 0 !important;
		  margin-bottom: 5px !important;
    padding: 0 !important;
    }

    .payment-options {
        gap: 5px !important;
        margin: 8px 0 !important;
    }

    .payment-option {
        padding: 6px 10px !important;
        font-size: 0.7rem !important;
    }


        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            z-index: 3000;
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid var(--primary-color);
            border-top-color: transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .current-location-btn {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--primary-color);
            cursor: pointer;
            padding: 5px;
            font-size: 18px;
        }

        .map-select-btn {
		
            margin-top: 10px;
            width: 100%;
            padding: 8px;
            font-size: 14px;
        }

        .driver-info {
            position: fixed;
            top: auto !important;
		    bottom: 80px;
            left: 15px !important;
            right: auto !important;
            transform: none !important;
            background: rgba(46, 46, 46, 0.9);
			    /* ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø­Ø¬Ù… */
    width: 200px;
    max-height: 40vh;
    overflow: hidden;
            padding: 20px;
            border-radius: 8px;
            z-index: 1000;
            max-width: 300px;
            backdrop-filter: blur(5px);
            display: none;
		    stroke: #00FF00 !important;
            stroke-opacity: 0.8 !important;
            stroke-width: 6px !important;
            stroke-dasharray: none !important;
           animation: pulse 2s infinite;
		       /* ØªØµÙ…ÙŠÙ… Ø£ÙƒØ«Ø± Ø´ÙØ§ÙÙŠØ© */
    background: rgba(30, 30, 30, 0.92) !important;
    backdrop-filter: blur(8px);
    border: 1px solid rgba(255,255,255,0.1);
        }
        @keyframes pulse {
           0% { stroke-opacity: 0.8; }
           50% { stroke-opacity: 0.4; }
          100% { stroke-opacity: 0.8; }
        }
        .driver-route-line {
            stroke-color: #FF6B6B;
            stroke-opacity: 0.7;
            stroke-weight: 4;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #00CED1;
            color: #2E2E2E;
            padding: 15px 25px;
            border-radius: 8px;
            z-index: 5000;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            animation: slideIn 0.3s ease-out;
            display: none;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @keyframes slideIn {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }
		.persistent-notification {
		    /* ØªØºÙŠÙŠØ± Ø§Ù„Ù…ÙˆØ¶Ø¹ Ø¥Ù„Ù‰ Ø§Ù„Ø²Ø§ÙˆÙŠØ© Ø§Ù„Ø³ÙÙ„ÙŠØ© Ø§Ù„ÙŠØ³Ø±Ù‰ */
    top: auto !important;
    bottom: 80px;
    left: 15px !important;
    right: auto !important;
    transform: none !important;
    
    /* ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø­Ø¬Ù… */
    width: 200px;
    max-height: 35vh;
    overflow: hidden;
    
    /* ØªØµÙ…ÙŠÙ… Ø£ÙƒØ«Ø± Ø´ÙØ§ÙÙŠØ© */
    background: rgba(1, 1, 1, 0.6) !important; /* Ø´ÙØ§ÙÙŠØ© Ø¹Ø§Ù„ÙŠØ© */
    border: 1px solid rgba(255,255,255,0.1);
        position: fixed;
        padding: 20px;
        border-radius: 8px;
        z-index: 1000;
        border: 2px solid var(--primary-color);
        display: none;
         color: #fff;
        top: 20px !important;
        max-width: 200px !important;
        }
		.persistent-notification h3 {
        color: #fff !important;
        margin-bottom: 15px;
        }

       .persistent-notification p {
          margin: 8px 0;
          font-size: 16px;  
        }
		.notification.success {
         background: #4CAF50;
         padding: 20px;
         font-size: 18px;
         display: flex;
         align-items: center;
         width: 350px;
         border-left: 5px solid #45a049;
        }

        .notification-content {
          display: flex;
          flex-direction: column;
          gap: 15px;
          width: 100%;
        }

        .confirm-btn {
          background: rgba(255, 255, 255, 0.9);
          color: #4CAF50;
          padding: 10px 25px;
          border-radius: 8px;
          font-weight: bold;
          transition: all 0.3s;
          align-self: flex-end;
        }

        .confirm-btn:hover {
           background: #fff;
           transform: translateY(-2px);
           box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }
	    .end-notification {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(46, 46, 46, 0.95);
        padding: 40px 60px;
        border-radius: 15px;
        text-align: center;
        z-index: 10000;
        border: 3px solid #00CED1;
        box-shadow: 0 8px 30px rgba(0,0,0,0.5);
        color: #FFF;
        }

        .end-notification h2 {
        color: #00CED1;
        margin-bottom: 20px;
        font-size: 28px;
        }

        .end-notification .price {
        font-size: 24px;
        margin: 20px 0;
        }
    @media (max-width: 768px) {
    .profile-btn {
        position: fixed !important;
        bottom: 1px !important;
        left: 15px !important;
        right: auto !important;
        top: auto !important;
        transform: none !important;
        margin: 0 !important;
        z-index: 1001 !important;
        padding: 10px 5px !important;
        width: auto !important;
  background: linear-gradient(
    135deg,
    rgba(76, 175, 80, 0.9) 0%,    /* Ø£Ø®Ø¶Ø± Ø´ÙØ§Ù */
    rgba(255, 82, 82, 0.9) 100%   /* Ø£Ø­Ù…Ø± Ø´ÙØ§Ù */
  ) !important;
  border: none !important;
  border-radius: 25px !important;
  color: white !important;
  box-shadow: 
    0 8px 32px rgba(76, 175, 80, 0.3),
    0 4px 12px rgba(255, 255, 255, 0.1) inset !important;
  transition: all 0.4s cubic-bezier(0.215, 0.61, 0.355, 1) !important;
  overflow: hidden !important;
  backdrop-filter: blur(8px) !important;
  border: 1px solid rgba(255, 255, 255, 0.2) !important;
    /* Ø­Ø¯ÙˆØ¯ Ù…ØªØ­Ø±ÙƒØ© */
   
	}
/* Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø¨Ø±ÙˆÙÙŠÙ„ Ø§Ù„Ù…Ø¹Ø¯Ù„Ø© */
.profile-btn .fa-chevron-left {
  color: rgba(255, 255, 255, 0.9) !important;
  transition: all 0.3s ease !important;
  font-size: 14px !important;
}
    .profile-text {
  position: relative;
  z-index: 1;
  text-shadow: 
    0 2px 4px rgba(0, 0, 0, 0.3),
    0 0 8px rgba(76, 175, 80, 0.5) !important;
  transition: all 0.3s ease !important;
}
.profile-btn:hover .profile-text {
  text-shadow: 
    0 3px 6px rgba(0, 0, 0, 0.4),
    0 0 12px rgba(255, 82, 82, 0.6) !important;
}
	/* ØªØ£Ø«ÙŠØ± Ø­Ø¯ÙˆØ¯ Ù…ØªØ­Ø±ÙƒØ© */
.profile-btn::before {
  content: '';
  position: absolute;
  top: -2px;
  left: -2px;
  right: -2px;
  bottom: -2px;
  background: linear-gradient(
    45deg,
    #4CAF50 0%,
    #FF5252 50%,
    #4CAF50 100%
  );
  z-index: -1;
  border-radius: 25px;
  animation: border-flow 3s linear infinite;
  background-size: 200% auto;
}

    .profile-btn i {
        font-size: 14px !important;
        margin-right: 5px !important;
    }
	@keyframes border-flow {
  0% { background-position: 0% center; }
  100% { background-position: -200% center; }
}

    /* Ù…Ù†Ø¹ ØªØ¯Ø§Ø®Ù„ Ù…Ø¹ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø£Ø®Ø±Ù‰ */
    .action-buttons {
        left: 50% !important;
        transform: translateX(-50%) !important;
        width: 90% !important;
        bottom: 80px !important; /* Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø¨Ø¹Ø¯ Ø¹Ù† Ø§Ù„Ø£Ø³ÙÙ„ */
    }
}
.pulsating-marker {
    animation: pulse 1.5s infinite;
    text-shadow: 0 0 10px currentColor;
}

@keyframes pulse {
    0% { transform: scale(0.9); opacity: 0.8; }
    50% { transform: scale(1.2); opacity: 1; }
    100% { transform: scale(0.9); opacity: 0.8; }
}
		@media (max-width: 768px) {
           .control-panel {
		       z-index: 100 !important;

        flex-direction: row !important;
        flex-wrap: nowrap !important;
        gap: 0 !important;
        padding: 0 !important;
    }

.map-select-btn {

    margin-top: 8px;
    padding: 8px;
    font-size: 10px;
}
      /* ØªØ¹Ø¯ÙŠÙ„ Ø­Ù‚Ù„ÙŠ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ */
    .input-field {
	
        flex: 1 !important;
        min-width: 20% !important;
        margin: 0 !important;
        border-radius: 0 !important;
        padding: 3px !important;
    }
	
/* ØªÙ†Ø³ÙŠÙ‚ Ø¹Ø§Ù… Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ */
.input-field input {
  border: 2px solid rgba(76, 175, 80, 0.3) !important; /* Ø£Ø®Ø¶Ø± Ø´ÙØ§Ù */
  transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) !important;
  box-shadow: 0 2px 8px rgba(76, 175, 80, 0.1) !important;
}

/* Ø¹Ù†Ø¯ Ø§Ù„ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ø­Ù‚Ù„ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© */
#origin:focus {
  border-color: #4CAF50 !important; /* Ø£Ø®Ø¶Ø± ÙƒØ§Ù…Ù„ */
  box-shadow: 
    0 0 15px rgba(76, 175, 80, 0.3),
    inset 0 1px 3px rgba(76, 175, 80, 0.2) !important;
}

/* Ø¹Ù†Ø¯ Ø§Ù„ØªØ±ÙƒÙŠØ² Ø¹Ù„Ù‰ Ø­Ù‚Ù„ Ø§Ù„Ù†Ù‡Ø§ÙŠØ© */
#destination:focus {
  border-color: #FF5252 !important; /* Ø£Ø­Ù…Ø± ÙƒØ§Ù…Ù„ */
  box-shadow: 
    0 0 15px rgba(255, 82, 82, 0.3),
    inset 0 1px 3px rgba(255, 82, 82, 0.2) !important;
}

/* ØªØ£Ø«ÙŠØ± ØªØ­ÙˆÙŠÙ… Ø¹Ø§Ù… */
.input-field input:hover {
  border-color: rgba(76, 175, 80, 0.5) !important;
  transform: translateY(-1px);
}

/* ØªØ£Ø«ÙŠØ± ØªØ­ÙˆÙŠÙ… Ø®Ø§Øµ Ø¨Ø­Ù‚Ù„ Ø§Ù„Ù†Ù‡Ø§ÙŠØ© */
#destination:hover {
  border-color: rgba(255, 82, 82, 0.5) !important;
}

/* Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ù†Ø¨Ø¶Ø§Øª Ø§Ù„Ø­Ø¯ÙˆØ¯ */
@keyframes input-pulse {
  0% { border-color: rgba(76, 175, 80, 0.3); }
  50% { border-color: rgba(76, 175, 80, 0.6); }
  100% { border-color: rgba(76, 175, 80, 0.3); }
}

.input-field input:not(:focus):hover {
  animation: input-pulse 1.5s infinite;
}

/* ØªØµÙ…ÙŠÙ… Ø§Ù„Ø¨Ù„ÙŠØ³ Ù‡ÙˆÙ„Ø¯Ø± */
.input-field input::placeholder {
  color:  #e0e0e0 !important; /* Ø§Ø¨ÙŠØ¶  */
  transition: all 0.3s ease;
}

#destination::placeholder {
  color: #e0e0e0 !important; /* Ø§Ø¨ÙŠØ¶  */
}

/* ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ù†Øµ Ø¹Ù†Ø¯ Ø§Ù„ÙƒØªØ§Ø¨Ø© */
.input-field input:valid {
  border-color: rgba(76, 175, 80, 0.8) !important;
  background: rgba(76, 175, 80, 0.03) !important;
}

#destination:valid {
  border-color: rgba(255, 82, 82, 0.8) !important;
  background: rgba(255, 82, 82, 0.03) !important;
}

/* Ø­Ø¯ÙˆØ¯ Ù…Ø¶ÙŠØ¦Ø© Ù…ØªÙ‚Ø¯Ù…Ø© */
.input-field input {
  position: relative;
  overflow: hidden;
}

.input-field input::after {
  content: '';
  position: absolute;
  top: -2px;
  left: -2px;
  right: -2px;
  bottom: -2px;
  border: 2px solid;
  border-radius: 6px;
  opacity: 0;
  animation: border-glow 2s infinite;
}

#origin::after { border-color: #4CAF50; }
#destination::after { border-color: #FF5252; }

@keyframes border-glow {
  0% { opacity: 0; }
  50% { opacity: 0.3; }
  100% { opacity: 0; }
}

.input-field input:focus::after {
  animation: border-glow 1s infinite;
}
    
        .action-buttons {
		    z-index: 1003 !important; /* Ø£Ø¹Ù„Ù‰ Ù…Ù† ÙƒÙ„ Ø§Ù„Ø¹Ù†Ø§ØµØ± */
  background: #000 !important; /* Ø®Ù„ÙÙŠØ© Ø´ÙØ§ÙØ© Ø®Ø¶Ø±Ø§Ø¡ */
          min-width: 100%;
		  bottom: 60px !important;
    padding: 1rem;
    font-size: 14px;
    transform: perspective(300px) rotateX(10deg);
      0 10px 25px rgba(0, 206, 209, 0.4),
      inset 0 0 10px rgba(255,255,255,0.2);
        }
    
        .btn {
          padding: 10px 20px;
          min-width: 120px;
		          flex: 1 1 45%;
		  
        }
    }
		
    .payment-options {
       display: flex;
      gap: 15px;
      margin: 20px 0;
      flex-direction: column;
    }

    .payment-option {
      padding: 15px;
     border-radius: 8px;
     cursor: pointer;
     transition: all 0.3s;
     background: rgba(255, 255, 255, 0.1);
     border: 2px solid transparent;
    }

    .payment-option.selected {
      background: var(--primary-color);
      color: var(--secondary-color);
      border-color: var(--accent-color);
    }

    .payment-option:hover {
      transform: scale(1.02);
    }
@media (max-width: 768px) {
    .driver-info, .persistent-notification {
        /* ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ø­Ø¬Ù… Ø§Ù„Ø¹Ø§Ù… */
        width: 60%;
        max-width: 150px;
        padding: 5px;
        
        /* ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø®Ø·ÙˆØ· */
        font-size: 0.6rem;
        
        /* ØªÙ‚Ù„ÙŠÙ„ Ø§Ù„Ù‡ÙˆØ§Ù…Ø´ */
        margin: 5px;
        top: 5px !important;
        
        /* Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¹Ù†Ø§ØµØ± ØºÙŠØ± Ø§Ù„Ø¶Ø±ÙˆØ±ÙŠØ© */
        .extra-details {
            display: none;
        }
    }
    
    /* Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ */
    .driver-info h3, .persistent-notification h3 {
        font-size: 1rem;
        margin-bottom: 8px;
    }
    
    /* Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù†ØµÙˆØµ */
    .driver-info p, .persistent-notification p {
        margin: 8px 0;
    }
    
    /* Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
    .close-btn, .toggle-info-btn {
        padding: 8px 12px;
        font-size: 0.85rem;
    }
    
    /* Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
    .toggle-info-btn i {
        font-size: 14px;
    }
}
    #confirmBookingButton {
      display: none;
      margin-top: 20px; 
    
    }
	.actual-route {
    stroke-color: #00CED1 !important;
    stroke-opacity: 0.8 !important;
    stroke-weight: 6 !important;
    stroke-dasharray: none !important;
     }
	
	/* ======= Ø²Ø± Ø§Ù„Ø¨Ø±ÙˆÙÙŠÙ„ ======= */
.profile-btn {
  /* Ø£Ø¶Ù Ø®Ù„ÙÙŠØ© Ø´ÙØ§ÙØ© Ø£Ùˆ Ù„ÙˆÙ† Ø«Ø§Ø¨Øª */
      background: linear-gradient(45deg, #FF69B4, #FF1493);     /* Ø£Ùˆ Ø£ÙŠ Ù„ÙˆÙ† ØªÙØ¶Ù„Ù‡ */
  border: 2px solid var(--accent-color); /* Ø³Ù…Ùƒ Ø§Ù„Ø¥Ø·Ø§Ø± ÙˆÙ„ÙˆÙ†Ù‡ */
  border-radius: 30px;                   /* Ù†ØµÙ Ù‚Ø·Ø± Ø§Ù„Ø§Ù†Ø­Ù†Ø§Ø¡ */
  padding: 8px 10px;                    /* Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ ÙˆØ§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ */
  font-size: 18px;                       /* Ø­Ø¬Ù… Ø§Ù„Ø®Ø· */
  color: var(--secondary-color);         /* Ù„ÙˆÙ† Ø§Ù„Ù†Øµ */
  display: flex;
  align-items: center;
  gap: 8px;
  transition: all 0.3s;
     box-shadow: 0 4px 15px rgba(255,105,180,0.4);

    /* Ø­Ø¯ÙˆØ¯ Ù…ØªØ­Ø±ÙƒØ© */
    border: none;
    position: relative;
    overflow: hidden;

}

.profile-btn:hover {
  background: var(--accent-color);
  color: #FFF;
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}
.profile-btn .fa-chevron-left {
  font-size: 16px;    /* Ø­Ø¬Ù… Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© */
  transition: transform 0.3s;
}
.profile-btn:hover .fa-chevron-left {
  transform: translateX(-4px);
}

.marker-label {
    background: rgba(0, 206, 209, 0.9);
    padding: 2px 8px;
    border-radius: 15px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.3);
}
@media (max-width: 768px) {
    .booking-details p,
    .booking-details .vehicle-type,
    .booking-details .total-price {
        line-height: 0.7 !important;
        margin: 2px 0 !important;
    
	}
}
.full-screen-map {
    height: 100vh !important;
    width: 100% !important;
    margin: 0 !important;
    border-radius: 0 !important;
    position: fixed;
    top: 0;
    left: 0;
    z-index: 50;
    border: none !important;
    box-shadow: none !important;
}
/* Ø£Ø¶Ù Ù‡Ø°Ù‡ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚Ø§Øª */
.theme-toggle {
  position: absolute;
  top: 110px;
  left: 1px;     /* Ø§Ù„Ù…Ø³Ø§ÙØ© Ù…Ù† Ø§Ù„Ø´Ù…Ø§Ù„ */
  z-index: 1000;
  display: flex;
  align-items: center;
  gap: 10px;
}

.switch {
  position: relative;
  display: inline-block;
  width: 60px;
  height: 34px;
}

.switch input {
  opacity: 0;
  width: 0;
  height: 0;
}

.slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: #2c3e50;
  transition: .4s;
  border-radius: 34px;
}
/* Ø²Ø± ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© - ØªØ¯Ø±Ø¬ Ø£Ø®Ø¶Ø± Ù…Ø¹ ØªØ£Ø«ÙŠØ± Ø«Ù„Ø§Ø«ÙŠ Ø§Ù„Ø£Ø¨Ø¹Ø§Ø¯ */
.input-actions button.btn-icon[onclick*="start"] {
  background: linear-gradient(145deg, #4CAF50, #45a049) !important;
  border: 2px solid #388E3C !important;
  color: #000 !important;
  font-weight: 1000 !important; /* Ø³Ù…Ùƒ Ø§Ù„Ø®Ø· */
  border-radius: 12px;
  padding: 12px 25px;
  box-shadow: 
    0 4px 15px rgba(76, 175, 80, 0.3),
    0 2px 5px rgba(0,0,0,0.1) inset !important;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  font-weight: 600;
  letter-spacing: 0.5px;
}

.input-actions button.btn-icon[onclick*="end"] {
  background: linear-gradient(145deg, #FF5252, #e53935) !important;
  border: 2px solid #D32F2F !important;
 color: #000 !important;
  font-weight: 1000 !important; /* Ø³Ù…Ùƒ Ø§Ù„Ø®Ø· */
  border-radius: 12px;
  padding: 12px 25px;
  box-shadow: 
    0 4px 15px rgba(255, 82, 82, 0.3),
    0 2px 5px rgba(0,0,0,0.1) inset !important;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  font-weight: 600;
  letter-spacing: 0.5px;
}

/* ØªØ£Ø«ÙŠØ± Ø§Ù„Ø¥Ø¶Ø§Ø¡Ø© Ø¹Ù†Ø¯ Ø§Ù„ØªØ­ÙˆÙŠÙ… */
.input-actions button.btn-icon:hover {
  transform: translateY(-2px);
  box-shadow: 
    0 6px 20px rgba(0,0,0,0.15),
    0 3px 6px rgba(0,0,0,0.1) inset !important;
}

/* ØªØ£Ø«ÙŠØ± Ø§Ù„Ø¶ØºØ· Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± */
.input-actions button.btn-icon:active {
  transform: translateY(1px);
  box-shadow: 
    0 2px 5px rgba(5,3,2,1) inset !important;
}

/* Ø¥Ø¶Ø§Ø¡Ø© Ø­Ø¯ÙˆØ¯ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ© */
.input-actions button.btn-icon::after {
  content: '';
  position: absolute;
  top: -2px;
  left: -2px;
  right: -2px;
  bottom: -2px;
  border-radius: 12px;
  z-index: -1;
  background: linear-gradient(45deg, 
    rgba(255,255,255,0.3), 
    rgba(255,255,255,0.1),
    transparent);
  opacity: 0;
  transition: opacity 0.3s;
}

.input-actions button.btn-icon:hover::after {
  opacity: 1;
}

/* Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª Ù…ØªØ­Ø±ÙƒØ© */
.input-actions button.btn-icon i {
  transition: transform 0.3s ease;
  margin-left: 8px;
}

.input-actions button.btn-icon:hover i {
  transform: scale(1.2) rotate(-5deg);
}

/* ØªØ£Ø«ÙŠØ± Ø¥Ø¶Ø§Ø¡Ø© Ø¹Ù†Ø¯ Ø§Ù„ØªØ±ÙƒÙŠØ² */
.input-actions button.btn-icon:focus {
  outline: none;
  animation: pulse-glow 1.5s infinite;
}

@keyframes advanced-vibration {
  0% { transform: translate(0, 6px) rotate(0); }
  25% { transform: translate(3px, 6px) rotate(1deg); }
  50% { transform: translate(-2px, 6px) rotate(-0.5deg); }
  75% { transform: translate(1px, 6px) rotate(0.5deg); }
  100% { transform: translate(0, 6px) rotate(0); }
}

.slider:before {
  position: absolute;
  content: "";
  height: 26px;
  width: 26px;
  left: 4px;
  bottom: 4px;
  background-color: white;
  transition: .4s;
  border-radius: 50%;
}

input:checked + .slider {
  background-color: #f1c40f;
}

input:checked + .slider:before {
  transform: translateX(26px);
}

.theme-label {
  font-size: 24px;
  filter: drop-shadow(0 0 5px rgba(0,0,0,0.3));
}
.pulsating-marker {
    animation: pulse 1.5s infinite;
    text-shadow: 0 0 10px currentColor;
}

@keyframes pulse {
    0% { transform: scale(0.9); opacity: 0.8; }
    50% { transform: scale(1.2); opacity: 1; }
    100% { transform: scale(0.9); opacity: 0.8; }
}
.gm-style-iw-c {
    box-shadow: 0 0 20px rgba(0, 206, 209, 0.5) !important;
    border-radius: 15px !important;
    background: linear-gradient(145deg, #0a1a30, #0d2342) !important;
}

.gm-style .gm-style-iw-t::after {
    background: linear-gradient(145deg, #0a1a30, #0d2342) !important;
    box-shadow: -5px -5px 15px rgba(10, 26, 48, 0.5),
                5px 5px 15px rgba(0, 0, 0, 0.3) !important;
}
    .current-location-btn {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 14px 18px;
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 20px;
    cursor: pointer;
	  top: 22%;
        left: 5px;
      
  }

 

  .current-location-btn .icon {

    font-size: 25px;
  }
  #priceButton {
  background: linear-gradient(135deg, 
    #2c3e50 0%,    /* Dark Blue */
    #3498db 50%,   /* Royal Blue */
    #8e44ad 100%) !important; /* Purple */
  color: #000 !important;
  border: 2px solid rgba(255,255,255,0.2) !important;
  border-radius: 15px;
  box-shadow: 
    0 8px 32px rgba(44, 62, 80, 0.3),
    0 4px 12px rgba(255,255,255,0.1) inset;
  text-shadow: 0 2px 4px rgba(3,0,0,0.3);
  position: relative;
  overflow: hidden;
  transition: all 0.4s cubic-bezier(0.215, 0.61, 0.355, 1);
}

/* ØªØ£Ø«ÙŠØ± Ù…Ø¹Ø¯Ù†ÙŠ Ù„Ø²Ø± Ø§Ù„Ø³Ø¹Ø± */
#priceButton::after {
  content: '';
  position: absolute;
  top: -50%;
  left: -50%;
  width: 200%;
  height: 200%;
  background: linear-gradient(45deg, 
    transparent 25%,
    rgba(255,255,255,0.1) 50%,
    transparent 75%);
  transform: rotate(45deg);
  animation: price-shine 4s infinite linear;
}

@keyframes price-shine {
  0% { transform: translateX(-100%) rotate(45deg); }
  100% { transform: translateX(100%) rotate(45deg); }
}
/* Ø²Ø± Ø§Ù„Ù…Ø³Ø­ - ØªØµÙ…ÙŠÙ… Ø¯Ø§ÙŠÙ†Ù…ÙŠÙƒÙŠ */
button[onclick="clearAll()"] {
  background: linear-gradient(135deg,
    #2d3436 0%,    /* Dark Gray */
    #636e72 100%) !important; /* Gray */
  color: #dfe6e9 !important;
  border: 2px solid #d63031 !important; /* Red Accent */
  border-radius: 15px;
  box-shadow: 
    0 8px 32px rgba(45, 52, 54, 0.3),
    0 4px 12px rgba(255,255,255,0.05) inset;
  transition: all 0.3s ease-in-out;
}

/* ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„ØªØ­ÙˆÙŠÙ… */
#priceButton:hover {
  transform: translateY(-3px) scale(1.05);
  box-shadow: 
    0 12px 40px rgba(44, 62, 80, 0.5),
    0 6px 20px rgba(255,255,255,0.15) inset;
}

button[onclick="clearAll()"]:hover {
  background: linear-gradient(135deg,
    #d63031 0%,    /* Red */
    #2d3436 100%) !important;
  border-color: #ff7675 !important; /* Light Red */
  color: white !important;
}

/* ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø¶ØºØ· */
#priceButton:active {
  transform: translateY(6px) scale(0.96);
  filter: brightness(1.2);
}

button[onclick="clearAll()"]:active {
  transform: translateY(4px);
  background: linear-gradient(135deg,
    #c23616 0%,    /* Dark Red */
    #2d3436 100%) !important;
}

/* Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ù†Ø¨Ø¶ Ù„Ø²Ø± Ø§Ù„Ø³Ø¹Ø± */
@keyframes price-pulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.02); }
  100% { transform: scale(1); }
}

#priceButton {
  animation: price-pulse 2.5s ease-in-out infinite;
}

/* Ø¥Ø¶Ø§Ø¡Ø© Ø­Ø¯ÙˆØ¯ ØªÙØ§Ø¹Ù„ÙŠØ© */
button[onclick="clearAll()"] {
  position: relative;
}

button[onclick="clearAll()"]::before {
  content: '';
  position: absolute;
  top: -2px;
  left: -2px;
  right: -2px;
  bottom: -2px;
  border-radius: 15px;
  border: 2px solid rgba(214, 48, 49, 0.4);
  opacity: 0;
  transition: opacity 0.3s;
}

button[onclick="clearAll()"]:hover::before {
  opacity: 1;
}
.notification {
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 15px 25px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    gap: 15px;
    backdrop-filter: blur(10px);
    z-index: 5000;
    transition: all 0.3s ease;
    opacity: 1;
}

.notification.success {
    background: rgba(0, 206, 209, 0.9);
    border: 1px solid #00CED1;
    color: #fff;
}

.notification.error {
    background: rgba(255, 68, 68, 0.9);
    border: 1px solid #ff4444;
    color: #fff;
}

.notification-icon {
    font-size: 24px;
}

.notification-text {
    font-size: 16px;
    line-height: 1.4;
}
.input-field.invalid {
    animation: shake 0.5s;
    border: 2px solid #ff4444 !important;
    box-shadow: 0 0 10px rgba(255, 68, 68, 0.3) !important;
}

@keyframes shake {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(5px); }
    75% { transform: translateX(-5px); }
}
.price-option .total-price {
    color: var(--accent-color);
    font-weight: bold;
    margin-top: 8px;
}

.vehicle-total {
    font-size: 1.2em;
    color: #00CED1;
}

#priceDisplay {
    background: rgba(255,255,255,0.1);
    padding: 15px;
    border-radius: 8px;
    margin: 15px 0;
}

#priceDisplay p {
    margin: 10px 0;
    font-size: 16px;
}

    </style>
</head>
<body>
     <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<div class="control-panel">
    <div class="user-controls">
       <button class="profile-btn" onclick="window.location.href='profile.html'">
    <span class="profile-text">Ø§Ù„Ø¨Ø±ÙˆÙÙŠÙ„</span>
    <i class="fas fa-chevron-left"></i> <!-- Ø³Ù‡Ù… Ù„Ù„Ø£Ù†ÙŠÙ…ÙŠØ´Ù† -->
</button>
    </div>
        <div class="control-panel">
    <div class="input-field">
	
        <div class="input-with-actions">
                <button class="current-location-btn" onclick="getCurrentLocation()">ğŸ¯</button>
            <input type="text" id="origin" placeholder="ğŸŸ¢ Ù†Ù‚Ø·Ù‡ Ø§Ù„Ø¨Ø¯Ø§ÙŠÙ‡">

            <div class="input-actions">
                <button class="btn-icon map-select-btn" onclick="setSelectionMode('start')">
                    <i class="fas fa-map-marker-alt"></i>
                    Ø§Ø®ØªÙŠØ§Ø± Ù…Ù† Ø§Ù„Ø®Ø±ÙŠØ·Ø©
                </button>
                <button class="btn-icon current-location-btn" onclick="getCurrentLocation()">
                    <i class="fas fa-location-arrow"></i>
                </button>
            </div>
        </div>
    </div>
    
    <div class="input-field">
        <div class="input-with-actions">
            <input type="text" id="destination" placeholder="ğŸ”´ Ù†Ù‚Ø·Ù‡ Ø§Ù„Ù†Ù‡Ø§ÙŠÙ‡ ">
            <div class="input-actions">
                <button class="btn-icon map-select-btn" onclick="setSelectionMode('end')">
                    <i class="fas fa-map-marker-alt"></i>
                    Ø§Ø®ØªÙŠØ§Ø± Ù…Ù† Ø§Ù„Ø®Ø±ÙŠØ·Ø©
                </button>
            </div>
        </div>
    </div>
</div>

    <div class="action-buttons">
        <button class="btn" id="priceButton" onclick="calculateRoute()">Ø§Ù„Ø³Ø¹Ø±</button>
        <button class="btn" onclick="clearAll()"> Ù…Ø³Ø­</button>
	    <button class="btn" id="confirmRideBtn" style="display:none;" onclick="confirmRide()">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø±Ø­Ù„Ø©</button>

    </div>
	<!-- Ø£Ø¶Ù Ù‡Ø°Ø§ ÙÙŠ HTML -->
<div id="themeToggle" class="theme-toggle">
  <label class="switch">
    <input type="checkbox" id="themeSwitch">
    <span class="slider round"></span>
  </label>
  <span class="theme-label">ğŸŒ™</span>
</div>

    <div class="route-info" id="routeInfo"></div>
     <div class="price-options" id="priceOptions">
    <div class="price-option" onclick="selectVehicle('normal', 5)">
        <h3>ğŸš— Ø¹Ø§Ø¯ÙŠØ©</h3>
        <p class="total-price">0 Ø¬Ù†ÙŠÙ‡</p>
    </div>
    <div class="price-option" onclick="selectVehicle('luxury', 10)">
        <h3>ğŸš• ÙØ§Ø®Ø±Ø©</h3>
        <p class="total-price">0 Ø¬Ù†ÙŠÙ‡</p>
    </div>
    <div class="price-option" onclick="selectVehicle('helicopter', 3)">
        <h3>ğŸ›µ Ø³ÙƒÙˆØªØ±</h3>
        <p class="total-price">0 Ø¬Ù†ÙŠÙ‡</p>
    </div>
</div>

    <div id="map"></div>

    <div class="booking-details" id="bookingDetails">
		    <div class="payment-options" id="paymentOptions">
        <div class="payment-option" onclick="selectPayment('electronic', event)">
            <h3>ğŸ’³ Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ù…Ø¹ Ø§Ù„ÙƒØ§Ø¨ØªÙ†</h3>
            <p>ØªØ£ÙƒÙŠØ¯ ÙÙˆØ±ÙŠ Ø¹Ø¨Ø± Ø§Ù„Ù…Ø­ÙØ¸Ø© Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©</p>
        </div>
        <div class="payment-option" onclick="selectPayment('cash', event)">
            <h3>ğŸ’µ Ø§Ù„Ø¯ÙØ¹ Ù†Ù‚Ø¯ÙŠ</h3>
            <p>Ø§Ù„Ø¯ÙØ¹ Ù…Ø¨Ø§Ø´Ø±Ø© Ù„Ù„Ø³Ø§Ø¦Ù‚ Ù†Ù‚Ø¯Ø§Ù‹ Ø¹Ù†Ø¯ Ø§Ù„ÙˆØµÙˆÙ„</p>
        </div>
    </div>
  <button class="btn" id="confirmBookingButton" onclick="confirmTrip()" style="margin-top: 25px; width: 100%;">
    ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø¬Ø² Ø§Ù„Ø¢Ù†
  </button>
    </div>

    <div class="loading-overlay" id="loading">
        <div class="spinner"></div>
        <p style="margin-top: 20px; color: var(--primary-color);">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø« ...</p>
    </div>

    <div class="driver-info" id="driverInfo">
        <h3>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø³Ø§Ø¦Ù‚</h3>
        <p id="driverName">Ø§Ù„Ø§Ø³Ù…: -</p>
        <p id="driverCar">Ø§Ù„Ø³ÙŠØ§Ø±Ø©: -</p>
        <p id="driverPhone">Ø§Ù„Ù‡Ø§ØªÙ: -</p>
	</div>

<!-- Ø£Ø¶Ù Ù‡Ø°Ø§ Ø§Ù„Ø¬Ø²Ø¡ ØªØ­Øª Ø¹Ù†ØµØ± driver-info -->
    <div class="persistent-notification" id="persistentNotification">
      <h3>Ø­Ø§Ù„Ø© Ø§Ù„Ø±Ø­Ù„Ø©</h3>
      <div id="tripStatusContent"></div>
       <button class="btn" onclick="clearAll()" style="margin-top:15px;">Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø±Ø­Ù„Ø©</button>
    </div>		
    <div id="arrivalNotification" class="notification" style="display: none;">
    <div class="notification-content">
        <span>ğŸ‰ ØªÙ… ÙˆØµÙˆÙ„ Ø§Ù„Ø³Ø§Ø¦Ù‚ Ø¥Ù„Ù‰ Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©!</span>
	    <div id="driverArrivalInfo"></div>
        <button class="btn confirm-btn" onclick="handleArrivalConfirmation()">Ù…ÙˆØ§ÙÙ‚</button>
    </div>
	
    <audio id="notificationSound" src="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3" loop></audio>
    </div>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAeQx0Ke798anRT_6xAwB-ViewDVb8Jq0U&libraries=places,geometry&callback=initMap" async defer></script>    
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCAwPCVPaxoTEV4n4APATlIKh3ppjMeZpk",
            authDomain: "data-c4c20.firebaseapp.com",
            databaseURL: "https://data-c4c20-default-rtdb.firebaseio.com",
            projectId: "data-c4c20",
            storageBucket: "data-c4c20.firebasestorage.app",
            messagingSenderId: "905131784305",
            appId: "1:905131784305:web:440e06647294b0d5e543d0"
        };

        const app = firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        let map, directionsService, driverDirectionsRenderer, directionsRenderer;
        let startMarker, endMarker, currentLocationMarker;
        let selectedVehicle = null;
        let currentPricePerKm = 0;
        let totalDistance = 0;
        let selectionMode = null;
        let geocoder;
        let currentLocationCoords = null;
        let tripListener = null;
        let driverLocationListener = null;
        let driverRoutePolyline = null;
        let destinationMarker;
        let arrivalSound = null; // Ù…ØªØºÙŠØ± Ù„ØªØªØ¨Ø¹ Ø­Ø§Ù„Ø© Ø§Ù„ØµÙˆØª
        let driverPathCoordinates = [];
        let driverPathPolyline = null;
		let currentTripId = localStorage.getItem('currentTripId') || null;
        let selectedPayment = null;
       let mapInitialized = false;
	   let isGhostCleaned = false;
           let driverMarker = null;
		   let isTripActive = false;
		   

        let tempMarker = null;
	   let originalMapState = {
       height: '',
       width: '',
       margin: '',
       borderRadius: '',
       position: '',
       top: '',
       left: ''
        };
		
		    document.getElementById('priceOptions').style.display = 'none';


// Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        document.addEventListener('DOMContentLoaded', () => {
            const isLoggedIn = localStorage.getItem('isLoggedIn');
          const userId = localStorage.getItem('userId');
    
             if (!isLoggedIn || !userId) {
              window.location.href = 'login.html';
             } else {
                  console.log('User ID on map page:', userId); // Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ù‚ÙŠÙ…Ø©
            }
        });


	  
      const mapStyles = {
                night: [
                    {
                        "elementType": "geometry",
                        "stylers": [
                            { "color": "#000000" },
                            { "lightness": -20 }
                        ]
                    },
                    {
                        "elementType": "labels.text.fill",
                        "stylers": [
                            { "color": "#cccccc" },
                            { "fontweight": "bold" }
                        ]
                    },
                    {
                        "elementType": "labels.text.stroke",
                        "stylers": [
                            { "color": "#1a1a1a" },
                            { "weight": 1.5 }
                        ]
                    },
                    {
                        "featureType": "road",
                        "elementType": "geometry",
                        "stylers": [
                            { "color": "#1a1a1a" },
                            { "weight": 2.5 },
                            { "gamma": 1.8 }
                        ]
                    },
                    {
                        "featureType": "water",
                        "elementType": "geometry",
                        "stylers": [
                            { "color": "#003366" },
                            { "lightness": -20 },
                            { "hue": "#0066ff" },
                            { "gamma": 1.8 }
                        ]
                    },
                    {
                        "featureType": "poi",
                        "stylers": [{ "visibility": "off" }]
                    },
                    {
                        "featureType": "transit",
                        "stylers": [{ "visibility": "off" }]
                    },
                    {
                        "featureType": "administrative",
                        "elementType": "labels",
                        "stylers": [{ "visibility": "simplified" }]
                    }
                ],
                day: [
                    {
                        "elementType": "geometry",
                        "stylers": [
                            { "color": "#f5f5f5" },
                            { "lightness": 50 }
                        ]
                    },
                    {
                        "elementType": "labels.text.fill",
                        "stylers": [
                            { "color": "#2d3436" },
                            { "weight": 0.5 }
                        ]
                    },
                    {
                        "elementType": "labels.text.stroke",
                        "stylers": [
                            { "color": "#ffffff" },
                            { "weight": 1 }
                        ]
                    },
                    {
                        "featureType": "road",
                        "elementType": "geometry",
                        "stylers": [
                            { "color": "#dfe6e9" },
                            { "weight": 1.2 }
                        ]
                    },
                    {
                        "featureType": "water",
                        "elementType": "geometry",
                        "stylers": [
                            { "color": "#a0d2eb" },
                            { "lightness": 20 }
                        ]
                    }
                ]
            };
 // Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù„ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø®Ø±ÙŠØ·Ø© - ØªØ­ØªØ§Ø¬ Ù„Ù„ØªØ¹Ø¯ÙŠÙ„
function initMap() {
    // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ Ø£ÙˆÙ„Ø§Ù‹
	    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ù…Ø¨Ø§Ø´Ø±Ø© Ø¨Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
    const defaultCenter = { lat: 30.0444, lng: 31.2357 }; // Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©
    initializeMap(defaultCenter);
    
        getCurrentLocationSilently();

    }
async function getCurrentLocationSilently() {
    if (!navigator.geolocation) return;
    
    try {
        const position = await new Promise((resolve, reject) => {
            navigator.geolocation.getCurrentPosition(resolve, reject, {
                enableHighAccuracy: true,
                timeout: 5000,
                maximumAge: 30000
            });
        });
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª
        const userLocation = {
            lat: position.coords.latitude,
            lng: position.coords.longitude
        };
        map.setCenter(userLocation);
        startMarker.setPosition(userLocation);
        startMarker.setMap(map);
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ© Ø¯ÙˆÙ† Ø§Ù†ØªØ¸Ø§Ø±
        updateAddressAsync(userLocation);
        
    } catch (error) {
        console.log('Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ ØºÙŠØ± Ù…ØªØ§Ø­ØŒ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ');
    }
}

async function updateAddressAsync(location) {
    try {
        const results = await new Promise((resolve, reject) => {
            geocoder.geocode({ location }, (results, status) => {
                status === 'OK' ? resolve(results) : reject(status);
            });
        });
        document.getElementById('origin').value = results[0]?.formatted_address || "Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ";
    } catch (error) {
        console.log('ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†');
    }
}
// Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø®Ø±ÙŠØ·Ø© - Ø¬Ø¯ÙŠØ¯Ø©
function initializeMap(center) {
    const savedTheme = localStorage.getItem('mapTheme') || 'night';
    map = new google.maps.Map(document.getElementById('map'), {
        center: center,
        zoom: 15,
        styles: mapStyles[savedTheme],
        disableDefaultUI: true,
        gestureHandling: "greedy",
        mapTypeControlOptions: {
            mapTypeIds: []
        }
    });

    // ØªÙ‡ÙŠØ¦Ø© Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø¹Ù†Ø§ØµØ±
    initializeMapComponents();
    setupThemeToggle(savedTheme);
    setupAutocomplete();
    setupEventListeners();
    
    // Ø¥Ø¶Ø§ÙØ© Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…Ø®ØªÙ„ÙÙ‹Ø§ Ø¹Ù† Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
    if (center.lat !== 30.0444) {
        startMarker.setPosition(center);
        startMarker.setMap(map);
    }
}

        function initializeMapComponents() {
            geocoder = new google.maps.Geocoder();
            directionsService = new google.maps.DirectionsService();
            
            directionsRenderer = new google.maps.DirectionsRenderer({
                     suppressMarkers: true,
                polylineOptions: {
                    strokeColor: "#4285F4",
                    strokeOpacity: 0.9,
                    strokeWeight: 8,
                    icons: [{
                        icon: {
                            path: google.maps.SymbolPath.FORWARD_CLOSED_ARROW,
                            scale: 3,
                            fillColor: "#00FF00",
                            strokeColor: "#FFFFFF"
                        },
                        offset: '100%',
                        repeat: '100px'
                    }]
                }
            });

            driverDirectionsRenderer = new google.maps.DirectionsRenderer({
                suppressMarkers: true,
                polylineOptions: {
                    strokeColor: "#FFA500",
                    strokeOpacity: 0.8,
                    strokeWeight: 7
                }
            });

            startMarker = createMarker('#4CAF50', 2.5);
            endMarker = createMarker('#FF5252', 2.2);

            trafficLayer = new google.maps.TrafficLayer();
            trafficLayer.setMap(map);
            setInterval(() => {
                trafficLayer.setMap(null);
                trafficLayer.setMap(map);
            }, 60000);
        }
		// Ø¯Ø§Ù„Ø© Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª
async function validateInputs() {
    const origin = document.getElementById('origin').value;
    const destination = document.getElementById('destination').value;
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¹Ø¯Ù… Ø§Ù„ÙØ±Ø§Øº
    if (!origin && !currentLocationCoords) {
        showNotification('Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ­Ø¯ÙŠØ¯ Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©', true);
        document.getElementById('origin').parentNode.style.border = "2px solid #ff4444";
        return false;
    }
    
    if (!destination) {
        showNotification('Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ­Ø¯ÙŠØ¯ Ù†Ù‚Ø·Ø© Ø§Ù„Ù†Ù‡Ø§ÙŠØ©', true);
        document.getElementById('destination').parentNode.style.border = "2px solid #ff4444";
        return false;
    }

    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ†
    try {
        if (!currentLocationCoords) {
            const originGeo = await geocodeAddress(origin);
            if (!originGeo) {
                showNotification('Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© ØºÙŠØ± ØµØ­ÙŠØ­', true);
                document.getElementById('origin').parentNode.style.border = "2px solid #ff4444";
                return false;
            }
        }
        
        const destGeo = await geocodeAddress(destination);
        if (!destGeo) {
            showNotification('Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù†Ù‡Ø§ÙŠØ© ØºÙŠØ± ØµØ­ÙŠØ­', true);
            document.getElementById('destination').parentNode.style.border = "2px solid #ff4444";
            return false;
        }
        
        return true;
    } catch (error) {
        console.error('Validation error:', error);
        showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ†', true);
        return false;
    }
}

// Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù„Ø¬ÙŠÙˆÙƒÙˆØ¯
function geocodeAddress(address) {
    return new Promise((resolve, reject) => {
        geocoder.geocode({ address }, (results, status) => {
            if (status === 'OK' && results[0]) {
                resolve(results[0].geometry.location);
            } else {
                resolve(null);
            }
        });
    });
}
function showNotification(message, isError = false) {
    const notification = document.createElement('div');
    notification.className = `notification ${isError ? 'error' : 'success'}`;
    notification.innerHTML = `
        <div class="notification-icon">${isError ? 'âš ï¸' : 'âœ…'}</div>
        <div class="notification-text">${message}</div>
    `;
    document.body.appendChild(notification);
    
    setTimeout(() => {
        notification.style.opacity = '0';
        setTimeout(() => notification.remove(), 300);
    }, 4000);
}

        function createMarker(color, scale) {
            return new google.maps.Marker({
                icon: {
                    path: "M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z",
                    fillColor: color,
                    fillOpacity: 0.9,
                    strokeColor: "#ffffff",
                    strokeWeight: 2,
                    scale: scale,
                    anchor: new google.maps.Point(12, 24)
                },
                zIndex: 999,
                optimized: false
            });
        }

        function setupThemeToggle(savedTheme) {
            const isDayMode = savedTheme === 'day';
            document.getElementById('themeSwitch').checked = isDayMode;
            document.querySelector('.theme-label').textContent = isDayMode ? 'ğŸŒ' : 'ğŸŒ™';
            document.body.className = isDayMode ? 'day-mode' : 'night-mode';

            document.getElementById('themeSwitch').addEventListener('change', (e) => {
                const isDayMode = e.target.checked;
                toggleTheme(isDayMode);
            });
        }

        function toggleTheme(isDayMode) {
            const theme = isDayMode ? 'day' : 'night';
            map.setOptions({ styles: mapStyles[theme] });
            
            startMarker.setIcon({
                ...startMarker.getIcon(),
                fillColor: isDayMode ? "#4CAF50" : "#4CAF50"
            });

            endMarker.setIcon({
                ...endMarker.getIcon(),
                fillColor: isDayMode ? "#FF5252" : "#FF5252"
            });

            directionsRenderer.setOptions({
                polylineOptions: {
                    strokeColor: isDayMode ? "#2d3436" : "#FF00FF"
                }
            });

            document.body.className = isDayMode ? 'day-mode' : 'night-mode';
            document.querySelector('.theme-label').textContent = isDayMode ? 'ğŸŒ' : 'ğŸŒ™';
            localStorage.setItem('mapTheme', theme);
        }

        function setupAutocomplete() {
            const originInput = document.getElementById('origin');
            const destinationInput = document.getElementById('destination');
            
            const autocompleteOptions = {
                componentRestrictions: { country: "eg" },
                fields: ["formatted_address", "geometry"],
                types: ["geocode"]
            };

            const originAutocomplete = new google.maps.places.Autocomplete(originInput, autocompleteOptions);
            const destinationAutocomplete = new google.maps.places.Autocomplete(destinationInput, autocompleteOptions);

            originAutocomplete.addListener('place_changed', () => handlePlaceSelect(originAutocomplete, startMarker));
            destinationAutocomplete.addListener('place_changed', () => handlePlaceSelect(destinationAutocomplete, endMarker));
        }

        function handlePlaceSelect(autocomplete, marker) {
            const place = autocomplete.getPlace();
            if (place.geometry) {
                marker.setPosition(place.geometry.location);
                marker.setMap(map);
                map.panTo(place.geometry.location);
            }
        }

        function setupEventListeners() {
            map.addListener('click', (e) => {
                if (selectionMode) handleMapClick(e.latLng);
            });

            window.addEventListener('load', restorePreviousTrip);
            
            if (currentTripId) {
                setupTripListener();
                restoreTripState();
            }

            database.ref('rides').on('value', drawTripHotspots);
        }
			
			// ÙÙŠ Ø¨Ø¯Ø§ÙŠØ© Ù…Ù„Ù Ø§Ù„Ø®Ø±ÙŠØ·Ø©

      function handleMapClick(latLng) {
        if (!selectionMode) return;

    // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ø¤Ù‚ØªØ© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
    if (tempMarker) tempMarker.setMap(null);

    // Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù„Ø§Ù…Ø© Ù…Ø¤Ù‚ØªØ© Ù…Ø¹ ØªØ£Ø«ÙŠØ±
    tempMarker = new google.maps.Marker({
        position: latLng,
        map: map,
        icon: {
            path: google.maps.SymbolPath.CIRCLE,
            scale: 12,
            fillColor: selectionMode === 'start' ? '#4CAF50' : '#FF5252',
            fillOpacity: 0.8,
            strokeColor: '#fff',
            strokeWeight: 2
        },
        animation: google.maps.Animation.DROP,
        zIndex: 999
    });

    // Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…ÙˆÙ‚Ø¹
    const geocoder = new google.maps.Geocoder();
    geocoder.geocode({location: latLng}, (results, status) => {
        const address = status === 'OK' && results[0] ? 
            results[0].formatted_address : 
            'Ù…ÙˆÙ‚Ø¹ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';

        const infoWindow = new google.maps.InfoWindow({
            content: `
                <div class="location-info">
                    <h3>${selectionMode === 'start' ? 'Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø±Ø­Ù„Ø©' : 'Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø±Ø­Ù„Ø©'}</h3>
                    <p>${address}</p>
                    <button onclick="confirmLocation('${selectionMode}')">
                        ØªØ£ÙƒÙŠØ¯ Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆÙ‚Ø¹
                    </button>
                </div>
            `
        });
        
        infoWindow.open(map, tempMarker);
    });
}
function confirmLocation(mode) {
    if (!tempMarker) return;

    const position = tempMarker.getPosition();
    const fieldId = mode === 'start' ? 'origin' : 'destination';
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ù‚Ù„ Ø§Ù„Ù…Ø¹Ù†ÙŠ
    document.getElementById(fieldId).value = 'Ø¬Ø§Ø±ÙŠ ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†...';
    
    // Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø¹ÙƒØ³ÙŠ Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
    new google.maps.Geocoder().geocode({location: position}, (results) => {
        if (results[0]) {
            document.getElementById(fieldId).value = results[0].formatted_address;
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ø¯Ø§Ø¦Ù…Ø©
            if (mode === 'start') {
                startMarker.setPosition(position);
                startMarker.setMap(map);
            } else {
                endMarker.setPosition(position);
                endMarker.setMap(map);
            }
        }
        
        // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù…Ø¤Ù‚ØªØ§Øª
        tempMarker.setMap(null);
        map.setOptions({draggableCursor: 'grab'});
        selectionMode = null;
    });
}
// Ø¯Ø§Ù„Ø© Ù…Ø¹Ø§Ù„Ø¬Ø© Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ù…ÙˆÙ‚Ø¹ - Ø¬Ø¯ÙŠØ¯Ø©
function handleGeolocationError(error) {
    let message = '';
    switch(error.code) {
        case error.PERMISSION_DENIED:
            message = 'ØªÙ… Ø±ÙØ¶ Ø·Ù„Ø¨ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹';
            break;
        case error.POSITION_UNAVAILABLE:
            message = 'Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹ ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©';
            break;
        case error.TIMEOUT:
            message = 'Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù…Ù‡Ù„Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹';
            break;
        default:
            message = 'Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹';
    }
    showNotification(message, true);
}
		 function confirmRide() {
              document.getElementById('persistentNotification').style.display = 'none';
              clearAll();
              showNotification('ØªÙ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø±Ø­Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­!');
         }
        function getCurrentLocation() {
    return new Promise((resolve, reject) => {
        if (!navigator.geolocation) {
            reject('Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ø®Ø¯Ù…Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹');
            return;
        }

        showLoading(true);
        
        navigator.geolocation.getCurrentPosition(
            async (position) => {
                try {
                    currentLocationCoords = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    };

                    // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£ÙˆÙ„Ø§Ù‹
                    startMarker.setPosition(currentLocationCoords);
                    startMarker.setMap(map);
                    map.panTo(currentLocationCoords);

                    // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù†ÙˆØ§Ù†
                    const results = await new Promise((resolve, reject) => {
                        geocoder.geocode({ location: currentLocationCoords }, (results, status) => {
                            if (status === 'OK') resolve(results);
                            else reject(status);
                        });
                    });

                    document.getElementById('origin').value = results[0]?.formatted_address || "Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ";
                    resolve(currentLocationCoords);

                } catch (error) {
                    console.error('Geocoding error:', error);
                    document.getElementById('origin').value = "Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ";
                    showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¨Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠØ©', false);
                    resolve(currentLocationCoords);
                } finally {
                    showLoading(false);
                }
            },
            (error) => {
                showLoading(false);
                handleGeolocationError(error);
                reject(error);
            },
            {
                enableHighAccuracy: true,
                timeout: 5000,
                maximumAge: 0
            }
        );
    });
}

        function setSelectionMode(mode) {
             selectionMode = mode;
    document.querySelectorAll('.map-select-btn').forEach(btn => 
        btn.classList.remove('active'));
    document.querySelector(`[onclick="setSelectionMode('${mode}')"]`)
        .classList.add('active');
    
    // ØªØºÙŠÙŠØ± Ø´ÙƒÙ„ Ø§Ù„Ù…Ø¤Ø´Ø±
    map.setOptions({draggableCursor: 'crosshair'});
    showNotification(`Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ù„ØªØ­Ø¯ÙŠØ¯ ${mode === 'start' ? 'Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©' : 'Ù†Ù‚Ø·Ø© Ø§Ù„Ù†Ù‡Ø§ÙŠØ©'}`);
}

        async function calculateRoute() {
		    document.querySelectorAll('.input-field').forEach(field => {
        field.style.border = "none";
    });

    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØµØ­Ø©
    const isValid = await validateInputs();
    if (!isValid) return;
		    const mapElement = document.getElementById('map');
    originalMapState = {
        height: mapElement.style.height,
        width: mapElement.style.width,
        margin: mapElement.style.margin,
        borderRadius: mapElement.style.borderRadius,
        position: mapElement.style.position,
        top: mapElement.style.top,
        left: mapElement.style.left
    };
		 document.querySelector('.profile-btn').style.display = 'none';
    document.getElementById('map').classList.add('full-screen-map');
    document.getElementById('priceButton').style.display = 'none';

    let origin = document.getElementById('origin').value;
    const destination = document.getElementById('destination').value;
    document.querySelector('.control-panel').style.opacity = '1';

    if ((!origin && !currentLocationCoords) || !destination) {
        showNotification('Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ­Ø¯ÙŠØ¯ Ù†Ù‚Ø·ØªÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© ÙˆØ§Ù„Ù†Ù‡Ø§ÙŠØ©', true);
        return;
    }

    showLoading(true);

    try {
        let originLocation;
        
        // ØªØ­Ø¯ÙŠØ¯ Ù…ØµØ¯Ø± Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª
        if (currentLocationCoords) {
            originLocation = new google.maps.LatLng(
                currentLocationCoords.lat,
                currentLocationCoords.lng
            );
        } else {
            // Ø¬ÙŠÙˆÙƒÙˆØ¯ Ù„Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙŠØ¯ÙˆÙŠ
            const geocodeResult = await new Promise((resolve, reject) => {
                geocoder.geocode({ address: origin }, (results, status) => {
                    if (status === 'OK' && results[0]) {
                        resolve(results[0].geometry.location);
                    } else {
                        reject('ÙØ´Ù„ ÙÙŠ ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©');
                    }
                });
            });
            originLocation = geocodeResult;
        }

        // Ø¬ÙŠÙˆÙƒÙˆØ¯ Ù„Ù„Ù†Ù‡Ø§ÙŠØ©
        const destinationResult = await new Promise((resolve, reject) => {
            geocoder.geocode({ address: destination }, (results, status) => {
                if (status === 'OK' && results[0]) {
                    resolve(results[0].geometry.location);
                } else {
                    reject('ÙØ´Ù„ ÙÙŠ ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù†Ù‡Ø§ÙŠØ©');
                }
            });
        });

        const request = {
            origin: originLocation,
            destination: destinationResult,
            travelMode: 'DRIVING'
        };

        const response = await directionsService.route(request);
        
        // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
        directionsRenderer.setMap(map);
        directionsRenderer.setDirections(response);
        
        // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³Ø§ÙØ© ÙˆØ§Ù„Ø³Ø¹Ø±
        const route = response.routes[0].legs[0];
        totalDistance = route.distance.value / 1000;
            updatePriceOptions(totalDistance);

        // Ø¹Ø±Ø¶ Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø³Ø¹Ø±
        document.getElementById('priceOptions').style.display = 'block';
        document.querySelectorAll('.input-field').forEach(field => {
            field.style.display = 'none';
        });
        // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        map.fitBounds(response.routes[0].bounds);
        startMarker.setPosition(originLocation);
        endMarker.setPosition(destinationResult);
        totalDistance = route.distance.value / 1000; // Ø§Ù„Ù…Ø³Ø§ÙØ© Ø¨Ø§Ù„ÙƒÙŠÙ„ÙˆÙ…ØªØ±Ø§Øª
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø¨Ù†Ø§Ø¡ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø³Ø§ÙØ©
        updatePriceOptions(totalDistance);
        
        // Ø¹Ø±Ø¶ Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø³Ø¹Ø±
        document.getElementById('priceOptions').style.display = 'flex';
    } catch (error) {
        console.error('Error:', error);
        showNotification('ÙØ´Ù„ ÙÙŠ Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³Ø§Ø±: ' + error.message, true);
    } finally {
        showLoading(false);
    }
}
function updatePriceOptions(distance) {
     const vehicles = {
        normal: 5,
        luxury: 10,
        helicopter: 3
    };

    Object.entries(vehicles).forEach(([type, price]) => {
        const total = (distance * price).toFixed(1);
        document.querySelector(`[onclick="selectVehicle('${type}', ${price})"] .total-price`).textContent = `${total} Ø¬Ù†ÙŠÙ‡`;
    });
}

        function selectVehicle(type, price) {
            selectedVehicle = type;
            currentPricePerKm = price;
                const totalPrice = (totalDistance * currentPricePerKm).toFixed(1);

            document.querySelectorAll('.price-option').forEach(option => {
                option.classList.remove('selected');
            });
            event.currentTarget.classList.add('selected');
            
             

		      // Ø¥Ø¸Ù‡Ø§Ø± Ù‚Ø³Ù… ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø¬Ø² ÙˆØ®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¯ÙØ¹
    document.getElementById('bookingDetails').style.display = 'block';
    document.getElementById('priceOptions').style.display = 'none';
    
    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¯ÙØ¹
    document.querySelectorAll('.payment-option').forEach(option => {
        option.classList.remove('selected');
    });
    document.getElementById('confirmBookingButton').style.display = 'none';
    selectedPayment = null;
}

        function showBookingDetails() {
            const totalPrice = (totalDistance * currentPricePerKm).toFixed(2);
            
              document.getElementById('bookingDetails').style.display = 'block';
              document.getElementById('priceOptions').style.display = 'none';
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¯ÙØ¹
             document.querySelectorAll('.payment-option').forEach(option => {
             option.classList.remove('selected');
          });
          document.getElementById('confirmBookingButton').style.display = 'none';
          selectedPayment = null;
		       document.querySelector('.profile-btn').style.display = 'none';
		}

        async function confirmTrip() {
		
            if (!selectedVehicle) {
                showNotification('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø§Ù„Ø®Ø¯Ù…Ø© Ø£ÙˆÙ„Ø§Ù‹', true);
                return;
            }
		    if (!selectedPayment) {
               showNotification('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹', true);
              return;
            }
            const userId = localStorage.getItem('userId');
               if (!userId) {
                  alert('ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹');
                 window.location.href = 'login.html';
            }

            showLoading(true);
        // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ù‡Ù†Ø§
		     document.querySelector('.profile-btn').style.display = 'none';
                                                document.querySelector('.action-buttons').style.display = 'none';
      			  document.getElementById('map').style.display = 'block'; // Ø¥Ø¶Ø§ÙØ© Ù‡Ø°Ø§ Ø§Ù„Ø³Ø·Ø±
       			  document.querySelector('.input-field').style.display = 'none';
                  document.getElementById('origin').parentNode.style.display = 'none';
                   document.getElementById('destination').parentNode.style.display = 'none';
          document.getElementById('persistentNotification').style.display = 'block';
          document.getElementById('tripStatusContent').innerHTML = `
           <h3>Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø³Ø§Ø¦Ù‚...</h3>
            <div class="loading-spinner"></div>
          `;  
		  
		            document.getElementById('bookingDetails').style.display = 'none';

            const tripData = {
                start: document.getElementById('origin').value,
			    userId: userId, // ØªÙ… Ø¥Ø¶Ø§ÙØ© Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù‡Ù†Ø§
                end: document.getElementById('destination').value,
                vehicleType: selectedVehicle,
                price: (totalDistance * currentPricePerKm).toFixed(2),
                distance: totalDistance,
                status: "new",
    	        paymentMethod: selectedPayment, // Ø¥Ø¶Ø§ÙØ© Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹
                startLocation: startMarker.getPosition().toJSON(),
				endLocation: endMarker.getPosition().toJSON(), // Ø¥Ø¶Ø§ÙØ© Ù‡Ø°Ø§ Ø§Ù„Ø³Ø·Ø±
                timestamp: firebase.database.ServerValue.TIMESTAMP
            };

            try {
                let newTripRef = database.ref(`rides/${userId}`).push();
                await newTripRef.set(tripData);
                currentTripId = newTripRef.key;
                localStorage.setItem('currentTripId', currentTripId); // Ø§Ù„ØªØ­Ø¯ÙŠØ« Ù‡Ù†Ø§

                setupTripListener();
                showNotification('Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø³Ø§Ø¦Ù‚...');
                 document.querySelector('.profile-btn').style.display = 'none';
 document.querySelector('.action-buttons').style.display = 'none';
      			  document.getElementById('map').style.display = 'block'; // Ø¥Ø¶Ø§ÙØ© Ù‡Ø°Ø§ Ø§Ù„Ø³Ø·Ø±
       			  document.querySelector('.input-field').style.display = 'none';
                  document.getElementById('origin').parentNode.style.display = 'none';
                   document.getElementById('destination').parentNode.style.display = 'none';
          document.getElementById('persistentNotification').style.display = 'block';
          document.getElementById('tripStatusContent').innerHTML = `
           <h3>Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø³Ø§Ø¦Ù‚...</h3>
            <div class="loading-spinner"></div>
          `;

          document.getElementById('bookingDetails').style.display = 'nono';

            } catch (error) {
                showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø±Ø­Ù„Ø©', true);
                console.error('Error confirming trip:', error);
            } finally {
                showLoading(false);
            }
        }

// Ø¯Ø§Ù„Ø© Ù…Ø³Ø­ Ø§Ù„Ø¹Ù†Ø§ØµØ±
function clearMapElements() {
    if (directionsRenderer) directionsRenderer.setMap(null);
    if (driverDirectionsRenderer) driverDirectionsRenderer.setMap(null);
    if (startMarker) startMarker.setMap(null);
    if (endMarker) endMarker.setMap(null);
    if (driverMarker) driverMarker.setMap(null);
    if (driverRoutePolyline) driverRoutePolyline.setMap(null);
}
// Ø£Ø¶Ù Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ ÙÙŠ Ø¨Ø¯Ø§ÙŠØ© Ù…Ù„Ù script Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ
let wakeLock = null;

// Ø¯Ø§Ù„Ø© Ù„ØªÙØ¹ÙŠÙ„ Ù…Ù†Ø¹ Ù‚ÙÙ„ Ø§Ù„Ø´Ø§Ø´Ø©
async function enableWakeLock() {
    try {
        if ('wakeLock' in navigator) {
            wakeLock = await navigator.wakeLock.request('screen');
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªÙØ¹ÙŠÙ„ Ø¹Ù†Ø¯ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„
            document.addEventListener('visibilitychange', async () => {
                if (wakeLock !== null && document.visibilityState === 'visible') {
                    await enableWakeLock();
                }
            });
            
            console.log('Screen Wake Lock activated!');
        }
    } catch (err) {
        console.error('Error enabling wake lock:', err);
    }
}

// ØªØ´ØºÙŠÙ„ Ø§Ù„Ù…Ù†Ø¹ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
window.addEventListener('load', () => {
    enableWakeLock();
    
    // ØªÙØ¹ÙŠÙ„ Ø¥Ø¶Ø§ÙÙŠ Ø¹Ù†Ø¯ Ø£ÙŠ ØªÙØ§Ø¹Ù„ Ù…Ø³ØªØ®Ø¯Ù…
    document.addEventListener('click', enableWakeLock);
    document.addEventListener('touchstart', enableWakeLock);
});

// Optional: Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ù†Ø¹ Ø¹Ù†Ø¯ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØµÙØ­Ø©
window.addEventListener('beforeunload', () => {
    if (wakeLock) {
        wakeLock.release();
        wakeLock = null;

    }
});
        function setupTripListener() {
          const userId = localStorage.getItem('userId');
          const tripRef = database.ref(`rides/${userId}/${currentTripId}`);       
             tripListener = tripRef.on('value', async (snapshot) => {
             const tripData = snapshot.val();
			  // Ø¥Ø°Ø§ ØªÙ… Ø­Ø°Ù Ø§Ù„Ø±Ø­Ù„Ø© Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
               if (!tripData) {
                 localStorage.removeItem('currentTripId');
                 currentTripId = null;
                 clearAll();
                 return;
                }
				
				
             if (!tripData) return;
			 if (tripData.status === "com") {
			     document.getElementById('map').classList.add('full-screen-map');

			    document.getElementById('persistentNotification').style.display = 'nono';
				     document.querySelector('.profile-btn').style.display = 'none';
			       clearDriverTracking();
				       if (startMarker) startMarker.setMap(null);
                     if (endMarker) endMarker.setMap(null);
                    if (directionsRenderer) directionsRenderer.setMap(null);
    
    //   ØªÙƒØ¨ÙŠ Ø± Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø¹Ù„Ù‰ Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
                      const startLatLng = new google.maps.LatLng(
                      tripData.startLocation.lat,
                      tripData.startLocation.lng
                   );
     
                       map.setCenter(startLatLng);
                       map.setZoom(17); // Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªÙƒØ¨ÙŠØ± Ø§Ù„Ù…Ø·Ù„ÙˆØ¨
    
  const driverId = tripData.driverId;
  const driverLocationRef = database.ref(`drives/${driverId}/location`);

  // Ù…ØªØºÙŠØ± Ù„ØªØ®Ø²ÙŠÙ† Ù…Ø§Ø±ÙƒÙØ± Ø§Ù„Ø³Ø§Ø¦Ù‚

  // Ø§Ø³ØªÙ…Ø¹ Ù„ÙƒÙ„ ØªØºÙŠÙŠØ± ÙÙŠ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø³Ø§Ø¦Ù‚
  driverLocationRef.on('value', (snapshot) => {
    const loc = snapshot.val();
    if (!loc) return;

    const pos = new google.maps.LatLng(loc.lat, loc.lng);

    if (!driverMarker) {
      // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø§Ø±ÙƒÙØ± Ø£ÙˆÙ„ Ù…Ø±Ø©
      driverMarker = new google.maps.Marker({
        position: pos,
        map: map,
        icon: {
          url: "https://maps.gstatic.com/mapfiles/kml/shapes/cabs.png",
          scaledSize: new google.maps.Size(40, 40),
          anchor: new google.maps.Point(20, 20),
        },
        title: 'Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø³Ø§Ø¦Ù‚ Ø§Ù„Ø­Ø§Ù„ÙŠ'
      });
    } else {
      // ÙÙ‚Ø· Ø­Ø¯Ù‘Ø« Ø§Ù„Ù…ÙˆÙ‚Ø¹
      driverMarker.setPosition(pos);
    }

    // Ø§Ø®ØªÙŠØ§Ø±ÙŠ: ØªØ­Ø±ÙŠÙƒ Ù…Ø±ÙƒØ² Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ù„ÙŠÙ†Ø§Ø³Ø¨ Ø§Ù„Ù…Ø§Ø±ÙƒÙØ±
    // map.panTo(pos);
  });

                   showArrivalNotification(tripData.driverId); // <-- Ù‡Ù†Ø§ ØªÙ… Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø®Ø·Ø£
				   document.querySelector('.action-buttons').style.display = 'none';
      			  document.getElementById('map').style.display = 'block'; // Ø¥Ø¶Ø§ÙØ© Ù‡Ø°Ø§ Ø§Ù„Ø³Ø·Ø±
       			  document.querySelector('.input-field').style.display = 'none';
                  document.getElementById('origin').parentNode.style.display = 'none';
                   document.getElementById('destination').parentNode.style.display = 'none';
                     document.querySelector('.profile-btn').style.display = 'none';
                    return;
                }
                if (tripData.status === "end") {
				          if (driverLocationListener) {
                database.ref(`drives/${tripData.driverId}/location`).off('value', driverLocationListener);
                driverLocationListener = null;
            }

				    cleanGhostMapElements();
				    // Ù…Ø³Ø­ Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ø³Ø§Ø¦Ù‚ ÙˆØ§Ù„Ù…Ø³Ø§Ø±Ø§Øª
    if (driverMarker) {
        driverMarker.setMap(null);
        driverMarker = null;
    }
    if (driverDirectionsRenderer) {
        driverDirectionsRenderer.setMap(null);
        driverDirectionsRenderer = null;
    }
    if (driverRoutePolyline) {
        driverRoutePolyline.setMap(null);
        driverRoutePolyline = null;
    }
	   if(driverDirectionsRenderer) {
        driverDirectionsRenderer.setMap(null);
        driverDirectionsRenderer = null;
    }
    
    if(directionsRenderer) {
        directionsRenderer.setMap(null);
        directionsRenderer = null;
    }
    
				     document.querySelector('.profile-btn').style.display = 'none';
		            document.getElementById('map').style.display = 'none';
                    document.querySelector('.control-panel').style.display = 'none';
                    document.querySelector('.action-buttons').style.display = 'none';
                    document.getElementById('routeInfo').style.display = 'none';
                    document.getElementById('persistentNotification').style.display = 'none';
                   showEndNotification(tripData.price);
            // Ø¥ÙŠÙ‚Ø§Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªÙ…Ø¹ÙŠÙ†
                   tripRef.off('value', tripListener);
                if (driverLocationListener) {
                   database.ref(`drives/${tripData.driverId}/location`).off('value', driverLocationListener);
                }
                     return;
                }
				        // Ø¥Ø¶Ø§ÙØ© Ø­Ø§Ù„Ø© ready Ù‡Ù†Ø§
                if (tripData.status === "ready") {
				 
 // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ù…Ù† Ø§Ù„Ø®Ø±ÙŠØ·Ø© ÙˆØ¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…Ø±Ø¬Ø¹
  if (driverMarker) {
    driverMarker.setMap(null);
    driverMarker = null;
  }

				    document.getElementById('map').classList.add('full-screen-map');
                    
				     document.querySelector('.profile-btn').style.display = 'none';
                    clearMapElements();				
			       clearDriverTracking();
				  if (startMarker) startMarker.setMap(null);
                     if (endMarker) endMarker.setMap(null);
                    if (directionsRenderer) directionsRenderer.setMap(null);
                         if (driverMarker) driverMarker.setMap(null);

				  document.querySelector('.action-buttons').style.display = 'none';
      			  document.getElementById('map').style.display = 'block'; // Ø¥Ø¶Ø§ÙØ© Ù‡Ø°Ø§ Ø§Ù„Ø³Ø·Ø±
       			  document.querySelector('.input-field').style.display = 'none';
                  document.getElementById('origin').parentNode.style.display = 'none';
                   document.getElementById('destination').parentNode.style.display = 'none';
                   document.getElementById('persistentNotification').style.display = 'nono';

					    trackDriverToDestination(
                        tripData.driverId,
                         tripData.endLocation
                        );
   // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± Ø§Ù„Ø¯Ø§Ø¦Ù…
    document.getElementById('persistentNotification').style.display = 'nono';
    document.getElementById('tripStatusContent').innerHTML = `
        <h3>Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§Ù†Ø·Ù„Ø§Ù‚!</h3>
        <p>ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø³Ø§Ø± Ø­Ø³Ø¨ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ Ù„Ù„Ø³Ø§Ø¦Ù‚</p>
        <p>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙˆØ¬Ù‡ Ø¥Ù„Ù‰ Ø§Ù„ÙˆØ¬Ù‡Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©</p>
    `;
    
						    // ØªØ­Ø¯ÙŠØ« Ù…Ø±ÙƒØ² Ø§Ù„Ø®Ø±ÙŠØ·Ø©
                  const bounds = new google.maps.LatLngBounds();
                   bounds.extend(tripData.startLocation);
                   bounds.extend(tripData.endLocation);
                   map.fitBounds(bounds, {padding: 100});
                }

             if (tripData.status === "accepted" && tripData.driverId) {
                try {
                // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
                   directionsRenderer.setMap(null);
                   startMarker.setMap(map);
                   endMarker.setMap(null);
                  
				  
				  startMarker.setPosition(tripData.startLocation); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª
				       document.querySelector('.profile-btn').style.display = 'none';
                // Ø¥Ø®ÙØ§Ø¡ Ø¹Ù†Ø§ØµØ± Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
                   document.querySelector('.action-buttons').style.display = 'none';
			       document.getElementById('map').style.display = 'block'; // Ø¥Ø¶Ø§ÙØ© Ù‡Ø°Ø§ Ø§Ù„Ø³Ø·Ø±
		   	       document.querySelector('.input-field').style.display = 'none';
                   document.getElementById('origin').parentNode.style.display = 'none';
                  document.getElementById('destination').parentNode.style.display = 'none';
                 // Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³Ø§Ø¦Ù‚ 
                   const driverSnapshot = await database.ref(`drives/${tripData.driverId}`).once('value');
                   const driverData = driverSnapshot.val();
                // Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø§Ù„Ø¯Ø§Ø¦Ù…Ø©
                   document.getElementById('persistentNotification').style.display = 'block';
                   document.getElementById('tripStatusContent').innerHTML = `
                      <p>Ø§Ù„Ø§Ø³Ù…: ${driverData.fullName}</p>
                      <p>Ø§Ù„Ø³ÙŠØ§Ø±Ø©: ${driverData.carModel}</p>
                      <p>Ø§Ù„Ù‡Ø§ØªÙ: ${driverData.phoneNumber}</p>
				      <p>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹: ${tripData.paymentMethod === 'electronic' ? 'Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ' : 'Ù†Ù‚Ø¯ÙŠ'}</p>
                      <div id="distanceInfo">Ø¬Ø§Ø±ÙŠ Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³Ø§ÙØ©...</div>
                   `;

                // Ø¨Ø¯Ø¡ ØªØªØ¨Ø¹ Ø§Ù„Ù…ÙˆÙ‚Ø¹
                trackDriverLocation(tripData.driverId, tripData.startLocation);
                   document.getElementById('persistentNotification').style.display = 'block';

                } catch (error) {
                   console.error('Error:', error);
              }
            }
          });   
        }

		async function trackDriverToDestination(driverId, endLocation) {
    // Ø¥Ø²Ø§Ù„Ø© Ø£ÙŠ Ù…Ø³Ø§Ø±Ø§Øª Ø³Ø§Ø¨Ù‚Ø©
	
    if (directionsRenderer) {
        directionsRenderer.setMap(null);
    }
        if (driverMarker) {
        driverMarker.setMap(null);
        driverMarker = null;
    }

    // Ø¥Ù†Ø´Ø§Ø¡ renderer Ø¬Ø¯ÙŠØ¯
    directionsRenderer = new google.maps.DirectionsRenderer({
        suppressMarkers: true,
        polylineOptions: {
            strokeColor: "#4285F4",
            strokeOpacity: 0.9,
            strokeWeight: 7
        }
    });
    
    // Ù…ØªØ§Ø¨Ø¹Ø© ØªØ­Ø¯ÙŠØ«Ø§Øª Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø³Ø§Ø¦Ù‚
    const driverRef = database.ref(`drives/${driverId}/location`);
    driverRef.on('value', async (snapshot) => {
        const driverLoc = snapshot.val();
        if (!driverLoc) return;
        
        try {
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø³Ø§Ø± Ù…Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ Ø¥Ù„Ù‰ Ø§Ù„Ù†Ù‡Ø§ÙŠØ©
            const request = {
                origin: new google.maps.LatLng(driverLoc.lat, driverLoc.lng),
                destination: endLocation,
                travelMode: 'DRIVING'
            };
            
            const response = await directionsService.route(request);
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª
            if (driverMarker) driverMarker.setMap(null);
              if (directionsRenderer) {
    directionsRenderer.setMap(null);
  }
  if (endMarker) {
    endMarker.setMap(null);
  }

  // Ø¥Ù†Ø´Ø§Ø¡ renderer Ø¬Ø¯ÙŠØ¯
  directionsRenderer = new google.maps.DirectionsRenderer({
    suppressMarkers: true,
    polylineOptions: {
        strokeColor: "#9C27B0",
        strokeOpacity: 0.8,
        strokeWeight: 6,
        strokeDashArray: [10, 5],
        icons: [{
            icon: {
                path: google.maps.SymbolPath.FORWARD_CLOSED_ARROW,
                scale: 3,
                strokeColor: "#4A148C",
                fillColor: "#E1BEE7",
                fillOpacity: 1
            },
            offset: "100%",
            repeat: "50px"
        }]
    }
});    
	driverMarker = new google.maps.Marker({
                position: request.origin,
                map: map,
                icon: {
                    url: 'https://maps.gstatic.com/mapfiles/kml/shapes/cabs.png',
                    scaledSize: new google.maps.Size(40, 40)
                }
            });
            
            // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ù…Ø­Ø¯Ø«
            directionsRenderer.setOptions({
                map: map,
                directions: response
            });
endMarker = new google.maps.Marker({
        position: endLocation,
        map: map,
        title: 'Ù†Ù‚Ø·Ø© Ø§Ù„ÙˆØµÙˆÙ„',
            icon: {
        path: "M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z",
        fillColor: "#FF5252",
        fillOpacity: 0.9,
        strokeColor: "#ffffff",
        strokeWeight: 3,
        scale: 2.8,
        anchor: new google.maps.Point(12, 24)
    },
    label: {
        text: 'â—',
        color: "#FF5252",
        fontSize: "32px",
        className: "pulsating-marker"
    },
    zIndex: 999,
    optimized: false
});

            
                 // Ø¶Ø¨Ø· Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ù„ØªØ´Ù…Ù„ Ø§Ù„Ø£ØµÙ„ ÙˆØ§Ù„Ù†Ù‡Ø§ÙŠØ©
      const bounds = new google.maps.LatLngBounds();
      bounds.extend(originLatLng);
      bounds.extend(endLocation);
// 1. Ø§Ø³ØªØ®Ø¯Ø§Ù… maxZoom Ù…Ø¨Ø§Ø´Ø±Ø©:
map.fitBounds(bounds, {
  padding: 100,
  maxZoom: 100   // Ø­Ø¯Ø¯ Ø£Ù‚ØµÙ‰ Ù…Ø³ØªÙˆÙ‰ Ø²ÙˆÙ… ØªØ±ÙŠØ¯Ù‡
});

// 2. Ø£Ùˆ Ø§Ø³ØªØ®Ø¯Ø§Ù… setTimeout Ù„Ø¶Ù…Ø§Ù† Ø£Ù† fitBounds Ø§Ù†ØªÙ‡Øª:
map.fitBounds(bounds, { padding: 100 });
setTimeout(() => {
  // Ø§Ø¬Ø¹Ù„ Ø§Ù„Ø²ÙˆÙ… ÙŠØµÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„ØªÙŠ ØªØ±ÙŠØ¯Ù‡Ø§
  map.setZoom(100);
}, 500);
      
        } catch (error) {
            console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø³Ø§Ø±:', error);
        }
    });
}

        function showDriverRealTimeLocation(driverId) {
    // Ø¥Ø²Ø§Ù„Ø© Ø£ÙŠ Ù…Ø³ØªÙ…Ø¹ Ø³Ø§Ø¨Ù‚
            if (driverLocationListener) {
                 database.ref(`drives/${driverId}/location`).off('value', driverLocationListener);
            }

            const carIcon = {
                  url: "https://cdn-icons-png.flaticon.com/512/744/744515.png",
                  scaledSize: new google.maps.Size(40, 40),
                  anchor: new google.maps.Point(20, 20)
            };

            driverLocationListener = database.ref(`drives/${driverId}/location`).on('value', (snapshot) => {
               const driverLocation = snapshot.val();
            if (!driverLocation) return;

            const driverPos = new google.maps.LatLng(
                driverLocation.latitude,
                driverLocation.longitude
            );

            if (!driverMarker) {
               driverMarker = new google.maps.Marker({
                  position: driverPos,
                  map: map,
                  icon: carIcon,
                  title: 'Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ Ù„Ù„Ø³Ø§Ø¦Ù‚',
                  animation: google.maps.Animation.BOUNCE
                });
            } else {
               driverMarker.setPosition(driverPos);
            }

             map.panTo(driverPos);
             map.setZoom(17);
            });
        }

    async function trackDriverLocation(driverId, startLocation) {
	    if (!isTripActive) return; // Ø§Ù„ØªÙˆÙ‚Ù Ø¥Ø°Ø§ Ø§Ù„Ø±Ø­Ù„Ø© ØºÙŠØ± Ù†Ø´Ø·Ø©
  console.log("[Checkpoint 6] ØªØªØ¨Ø¹ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø³Ø§Ø¦Ù‚ - Ù…Ø¹Ø±Ù Ø§Ù„Ø³Ø§Ø¦Ù‚:", driverId);
const carIcon = {
  url: "https://maps.gstatic.com/mapfiles/kml/shapes/cabs.png",  // Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ù…Ù† Google
  scaledSize: new google.maps.Size(40, 40),                       // Ø§Ø¶Ø¨Ø· Ø§Ù„Ø­Ø¬Ù… Ø¨Ù…Ø§ ÙŠÙ†Ø§Ø³Ø¨Ùƒ
  anchor:    new google.maps.Point(24, 24)                        // ØªØ«Ø¨ÙŠØª Ù…Ù†ØªØµÙ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø©
};

  // ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª
  if (!startLocation || isNaN(startLocation.lat) || isNaN(startLocation.lng)) {
    console.error("[Error] Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© ØºÙŠØ± ØµØ§Ù„Ø­Ø©:", startLocation);
    return;
  }
  
  const startPos = new google.maps.LatLng(startLocation.lat, startLocation.lng);
  console.log("[Checkpoint 7] Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© (Ø§Ù„Ø¹Ù…ÙŠÙ„):", startPos.toString());
  
  const driverRef = database.ref(`drives/${driverId}/location`);
  console.log("[Checkpoint 8] Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙÙŠ ØªØ­Ø¯ÙŠØ«Ø§Øª Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø³Ø§Ø¦Ù‚");
  
  driverRef.on('value', async (snapshot) => {
    const driverLocation = snapshot.val();
    if (!driverLocation) {
      console.warn("[Warning] Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø³Ø§Ø¦Ù‚ ØºÙŠØ± Ù…ØªÙˆÙØ± Ø­Ø§Ù„ÙŠÙ‹Ø§");
      return;
    }
    
    console.log("[Checkpoint 9] Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„ÙˆØ§Ø±Ø¯Ø© Ù…Ù† Ø§Ù„Ø³Ø§Ø¦Ù‚:", driverLocation);
    
    // ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹
    if (!driverLocation.lat || !driverLocation.lng) {
      console.error("[Error] Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø§Ù„Ø³Ø§Ø¦Ù‚ ØºÙŠØ± ØµØ§Ù„Ø­Ø©");
      return;
    }
    
    const driverPos = new google.maps.LatLng(
      Number(driverLocation.lat),
      Number(driverLocation.lng)
    );
            // Ø¥Ù†Ø´Ø§Ø¡/ØªØ­Ø¯ÙŠØ« Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ø³Ø§Ø¦Ù‚
        if (!driverMarker) {
            driverMarker = new google.maps.Marker({
                position: driverPos,
                map: map, // Ø§Ù„ØªØ£ÙƒÙŠØ¯ Ø¹Ù„Ù‰ Ø¥Ø±ÙØ§Ù‚ Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø¨Ø§Ù„Ø®Ø±ÙŠØ·Ø©
                icon: carIcon,
                title: 'Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ Ù„Ù„Ø³Ø§Ø¦Ù‚',
                animation: google.maps.Animation.BOUNCE,
                zIndex: 9999
            });
            console.log('[ØªØªØ¨Ø¹ Ø§Ù„Ø³Ø§Ø¦Ù‚] ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ø³Ø§Ø¦Ù‚ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©');
        } else {
            driverMarker.setPosition(driverPos);
        }
    console.log("[Checkpoint 10] Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ Ù„Ù„Ø³Ø§Ø¦Ù‚:", driverPos.toString());
          // ØªØ­Ø¯ÙŠØ« Ù…Ø±ÙƒØ² Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ù„ÙŠØ´Ù…Ù„ Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø³Ø§Ø¦Ù‚ ÙˆÙ†Ù‚Ø·Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
        const bounds = new google.maps.LatLngBounds();
        bounds.extend(driverPos);
        bounds.extend(new google.maps.LatLng(startLocation.lat, startLocation.lng));
        map.fitBounds(bounds, {padding: 100});

        // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ† Ø§Ù„Ø³Ø§Ø¦Ù‚ ÙˆÙ†Ù‚Ø·Ø© Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
        const distance = google.maps.geometry.spherical.computeDistanceBetween(
            driverPos,
            new google.maps.LatLng(startLocation.lat, startLocation.lng)
        );
		       // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„Ù…Ø³Ø§ÙØ©
        document.getElementById('distanceInfo').innerHTML = `
            Ø§Ù„Ù…Ø³Ø§ÙØ© Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©: ${(distance / 1000).toFixed(1)} ÙƒÙ…
        `;
    // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³Ø§Ø±
    try {
      const request = {
        origin: driverPos,
        destination: startPos,
        travelMode: 'DRIVING'
      };
      
      console.log("[Checkpoint 11] Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨ Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³Ø§Ø±:", request);
      
      const response = await directionsService.route(request);
      console.log("[Checkpoint 12] Ø§Ø³ØªØ¬Ø§Ø¨Ø© Directions API:", response);
      
      // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø³Ø§Ø± Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
      if (driverDirectionsRenderer) {
        driverDirectionsRenderer.setMap(null);
      }
      
      driverDirectionsRenderer = new google.maps.DirectionsRenderer({
    suppressMarkers: true,
    polylineOptions: {
        strokeColor: "#FFA500",
        strokeOpacity: 0.8,
        strokeWeight: 6,
        strokeDashArray: [10, 5],
        icons: [{
            icon: {
                path: google.maps.SymbolPath.FORWARD_CLOSED_ARROW,
                scale: 3,
                strokeColor: "#FF4500",
                fillColor: "#FF8C00",
                fillOpacity: 1
            },
            offset: "100%",
            repeat: "50px"
        }]
    }
});
      
      driverDirectionsRenderer.setMap(map);
      driverDirectionsRenderer.setDirections(response);
      
    } catch (error) {
      console.error("[Error] ÙØ´Ù„ ÙÙŠ Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³Ø§Ø±:", error);
      console.error("Ø§Ù„ØªÙØ§ØµÙŠÙ„:", {
        origin: driverPos.toJSON(),
        destination: startPos.toJSON(),
        error: error.message
      });
    }
  });

}
        function updateDriverRoute(currentPos, startPos) {
              if (!isTripActive) return; // Ø¥ÙŠÙ‚Ø§Ù Ø£ÙŠ ØªØ­Ø¯ÙŠØ« Ø¥Ø°Ø§ Ø§Ù„Ø±Ø­Ù„Ø© ØºÙŠØ± Ù†Ø´Ø·Ø©

			if (driverRoutePolyline) {
                driverRoutePolyline.setMap(null);
            }

            driverRoutePolyline = new google.maps.Polyline({
                path: [currentPos, startPos],
                geodesic: true,
                strokeColor: "#FF00FF",
                strokeOpacity: 0.8,
                strokeWeight: 7,
                map: map
            });
        }
		function showArrivalNotification(driverId) {
            const notification = document.getElementById('arrivalNotification');
            const sound = document.getElementById('notificationSound');
    
    // ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³Ø§Ø¦Ù‚
            database.ref(`drives/${driverId}`).once('value').then((snapshot) => {
                const driverData = snapshot.val();
                document.getElementById('driverArrivalInfo').innerHTML = `
                     <p>Ø§Ù„Ø§Ø³Ù…: ${driverData.fullName}</p>
                     <p>Ø§Ù„Ù‡Ø§ØªÙ: <a href="tel:${driverData.phoneNumber}">${driverData.phoneNumber}</a></p>
                     <p>Ø§Ù„Ø³ÙŠØ§Ø±Ø©: ${driverData.carNumber}</p>
                     `;
                });

    // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØµÙˆØª
            sound.loop = true;
            sound.play().catch(() => {
            notification.innerHTML += '<p style="color:red;">ÙŠÙØ±Ø¬Ù‰ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª</p>';
            });

            notification.style.display = 'block';
        }    
        function handleArrivalConfirmation() {
            const notification = document.getElementById('arrivalNotification');
            const sound = document.getElementById('notificationSound');
    
    // Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ØµÙˆØª
            sound.pause();
            sound.currentTime = 0;
    
    // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø± ÙÙ‚Ø· Ø¯ÙˆÙ† Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            notification.style.display = 'none';
    
    // Ø¥Ø¨Ù‚Ø§Ø¡ Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ø³Ø§Ø¦Ù‚ Ø¸Ø§Ù‡Ø±Ø©
            if (driverMarker) {
             driverMarker.setAnimation(null); // Ø¥ÙŠÙ‚Ø§Ù ØªØ£Ø«ÙŠØ± Ø§Ù„Ø§Ø±ØªØ¯Ø§Ø¯
            }
        }
    	function clearDriverTracking() {
    // Ø¥Ø²Ø§Ù„Ø© ØªØªØ¨Ø¹ Ø§Ù„Ø³Ø§Ø¦Ù‚
            if (driverLocationListener) {
                 database.ref(`drives/${tripData.driverId}/location`).off('value', driverLocationListener);
                driverLocationListener = null;
           
			}

    // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª ÙˆØ§Ù„Ù…Ø³Ø§Ø±Ø§Øª
            if (driverMarker) driverMarker.setMap(null);
            if (driverDirectionsRenderer) driverDirectionsRenderer.setMap(null);
            driverDirectionsRenderer = null;

    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¹Ù†Ø§ØµØ±
            document.getElementById('persistentNotification').style.display = 'none';
        }
		function showActualRoute(startLoc, endLoc) {
    // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
            if(directionsRenderer) directionsRenderer.setMap(null);
            if(startMarker) startMarker.setMap(null);
            if(endMarker) endMarker.setMap(null);

    // Ø¥Ø¹Ø¯Ø§Ø¯ Ø®ØµØ§Ø¦Øµ Ø§Ù„Ù…Ø³Ø§Ø±
              directionsRenderer = new google.maps.DirectionsRenderer({
             suppressMarkers: false,
               polylineOptions: {
               strokeColor: "#0000FF",
              strokeOpacity: 0.8,
              strokeWeight: 6,
               zIndex: 1000
            },
              markerOptions: {
              opacity: 0.8 // Ø´ÙØ§ÙÙŠØ© Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª
    }
            });

    // Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù„Ø§Ù…Ø§Øª Ù…Ø®ØµØµØ©
            startMarker = new google.maps.Marker({
               position: startLoc,
               map: map,
               icon: {
                  path: google.maps.SymbolPath.CIRCLE,
                  scale: 8,
                 fillColor: "#00CED1",
                fillOpacity: 1,
                 strokeColor: "#FFF",
                strokeWeight: 2
                },
              zIndex: 1001
            });

            endMarker = new google.maps.Marker({
                position: endLoc,
               map: map,
             icon: {
              path: google.maps.SymbolPath.CIRCLE,
               scale: 8,
               fillColor: "#FF6B6B",
               fillOpacity: 1,
               strokeColor: "#FFF",
               strokeWeight: 2
              },
              zIndex: 1001
            });

    // Ø·Ù„Ø¨ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø³Ø§Ø±
             const request = {
                  origin: startLoc,
               destination: endLoc,
                travelMode: 'DRIVING',
                 provideRouteAlternatives: false,
                optimizeWaypoints: true
            };

           directionsService.route(request, (response, status) => {
                 if (status === 'OK') {
            // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø³Ø§Ø±
                 directionsRenderer.setMap(map);
                 directionsRenderer.setDirections(response);

            // Ø¥Ø¹Ø¯Ø§Ø¯ Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
               const bounds = new google.maps.LatLngBounds();
                 bounds.extend(startLoc);
                 bounds.extend(endLoc);
                 map.fitBounds(bounds);

            // Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø³Ø§Ø±
                const route = response.routes[0].legs[0];
                document.getElementById('routeInfo').style.display = 'block';
                document.getElementById('routeInfo').innerHTML = `
                <h3>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø±Ø­Ù„Ø©:</h3>
                <p>Ø§Ù„Ù…Ø³Ø§ÙØ©: ${route.distance.text}</p>
                <p>Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªÙˆÙ‚Ø¹: ${route.duration.text}</p>
                <div class="progress-bar" style="margin-top:15px;">
                    <div class="progress" style="height: 8px; background: #333; border-radius:4px;">
                        <div class="progress-fill" style="width: 100%; height:100%; background: var(--primary-color); border-radius:4px;"></div>
                    </div>
                </div>
               `;

            // Ø¥Ø¶Ø§ÙØ© Ø®Ø· Ù…ØªØ­Ø±Ùƒ Ù„Ù„Ù…Ø³Ø§Ø±
               const path = response.routes[0].overview_path;
               animateRoute(path);
            } else {
                   console.error('ÙØ´Ù„ ÙÙŠ Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø³Ø§Ø±:', status);
            }
            });
        }
		function animateRoute(path) {
            let count = 0;
           const line = new google.maps.Polyline({
           path: [],
           geodesic: true,
           strokeColor: "#00CED1",
           strokeOpacity: 0.8,
           strokeWeight: 6
           });

         const animate = () => {
            if (count >= path.length) {
            line.setMap(null);
            return;
          }

          line.getPath().push(path[count]);
          line.setMap(map);
          count++;
          setTimeout(animate, 50);
          };

            animate(); 
        }
        function showEndNotification(price) {
    // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¹Ù†ØµØ± Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯
	    cleanRouteMemory();
		    if (driverMarker) driverMarker.setMap(null);
    if (directionsRenderer) directionsRenderer.setMap(null);
		showEndNotification
    if(directionsRenderer) directionsRenderer.setMap(null);

           let endNotification = document.getElementById('endNotification');
    
            if (!endNotification) {
            endNotification = document.createElement('div');
            endNotification.id = 'endNotification';
            endNotification.className = 'end-notification';
            document.body.appendChild(endNotification);
            }

    // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰
           endNotification.innerHTML = `
               <h2>ØªÙ… Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ù†Ù‚Ø·Ø© Ø§Ù„Ù†Ù‡Ø§ÙŠØ©</h2>
               <div class="price">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø³Ø¹Ø± Ø§Ù„Ø±Ø­Ù„Ø©: ${price} Ø¬Ù†ÙŠÙ‡</div>
               <button class="btn" onclick="handlePaymentDone()" 
                    style="margin-top:20px; padding:12px 30px;">
                    ØªÙ… Ø§Ù„Ø¯ÙØ¹ ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ´ØºÙŠÙ„
                </button>
            `;
    // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª
    if (driverMarker) driverMarker.setMap(null);
    if (endMarker) endMarker.setMap(null);
    if (startMarker) startMarker.setMap(null);
    // ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª
             const sound = new Audio('https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3');
             sound.play().catch(() => {
             console.log('ÙŠÙØ±Ø¬Ù‰ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª');
            });

 
        }
		function handlePaymentDone() {
    // 1. Ø¥Ø®ÙØ§Ø¡ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ù‡Ø§ÙŠØ©
            const endNotification = document.getElementById('endNotification');
           if (endNotification) endNotification.remove();
    
    // 2. Ø¥Ø¹Ø§Ø¯Ø© Ø¹Ø±Ø¶ ÙƒÙ„ Ø§Ù„Ø¹Ù†Ø§ØµØ±
           document.getElementById('map').style.display = 'block';
           document.querySelector('.control-panel').style.display = 'flex';
           document.querySelector('.action-buttons').style.display = 'flex';
           document.getElementById('routeInfo').style.display = 'block';
    
    // 3. ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø®Ø±ÙŠØ·Ø© ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†
            clearAll();
    
    // 4. Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø¥Ø°Ø§ Ù„Ø²Ù… Ø§Ù„Ø£Ù…Ø± (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
           // initMap();
        }

// Ø¥Ø¶Ø§ÙØ© Ø¯Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù„Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø³Ø§Ø±
async function restoreRoute(startLoc, endLoc) {
    const request = {
        origin: startLoc,
        destination: endLoc,
        travelMode: 'DRIVING'
    };
    
    try {
	
        const response = await directionsService.route(request);
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª
        startMarker.setPosition(startLoc);
        startMarker.setMap(map);
        endMarker.setPosition(endLoc);
        endMarker.setMap(map)
		directionsRenderer.setMap(map);
        directionsRenderer.setDirections(response);
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª
        startMarker.setPosition(startLoc);
        endMarker.setPosition(endLoc);
        
        // ØªØ­Ø¯ÙŠØ« Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
        const bounds = new google.maps.LatLngBounds();
        bounds.extend(startLoc);
        bounds.extend(endLoc);
        map.fitBounds(bounds, {padding: 50});
        
    } catch (error) {
        console.error('ÙØ´Ù„ ÙÙŠ Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø³Ø§Ø±:', error);
    }
}
        async function restorePreviousTrip() {
           if (!currentTripId) return;
             
            showLoading(true);
            try {
    	     const userId = localStorage.getItem('userId');
             const tripRef = database.ref(`rides/${userId}/${currentTripId}`);
             const snapshot = await tripRef.once('value');
    
           if (!snapshot.exists()) {
                localStorage.removeItem('currentTripId');
             return;
            }
    
            const tripData = snapshot.val();
			    // Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø³Ø§Ø± Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø­Ø§Ù„Ø© new
        if (tripData.status === "new") {
		
            await restoreRoute(tripData.startLocation, tripData.endLocation);
            document.getElementById('priceOptions').style.display = 'flex';
            totalDistance = tripData.distance;
			            document.getElementById('priceOptions').style.display = 'none';
            document.querySelectorAll('.input-field').forEach(field => {
                field.style.display = 'none';
            });
        }
              await restoreTripState();

            } catch (error) {
                console.error('Error restoring trip:', error);
            } finally {
                showLoading(false);
            }
        }

       function handleStatusChange(status, tripData) {
           switch(status) {
          case 'new':
            showSearchingUI();
            break;
        case 'accepted':
            showAcceptedUI(tripData.driverId);
            break;
        case 'in_progress':
            showInProgressUI(tripData);
            break;
        case 'completed':
            showCompletedUI(tripData);
            break;
        case 'canceled':
            showCanceledUI();
            break;
        default:
            console.log('Unknown status:', status);
           }
        }

        function setupNewTripUI(tripData) {
             const userId = localStorage.getItem('userId');
             const tripRef = database.ref(`rides/${userId}/${currentTripId}`);
    
           tripListener = tripRef.on('value', (snapshot) => {
                const tripData = snapshot.val();
               if (!tripData) {
                clearAll();
                return;
            }
        
                 handleStatusChange(tripData.status, tripData);
            });
        }

        function showSearchingUI() {
		    document.getElementById('map').classList.add('full-screen-map');

		     document.querySelector('.action-buttons').style.display = 'none';
      			  document.getElementById('map').style.display = 'block'; // Ø¥Ø¶Ø§ÙØ© Ù‡Ø°Ø§ Ø§Ù„Ø³Ø·Ø±
       			  document.querySelector('.input-field').style.display = 'none';
                  document.getElementById('origin').parentNode.style.display = 'none';
                   document.getElementById('destination').parentNode.style.display = 'none';
          document.getElementById('persistentNotification').style.display = 'block';
          document.getElementById('tripStatusContent').innerHTML = `
           <h3>Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø³Ø§Ø¦Ù‚...</h3>
            <div class="loading-spinner"></div>
          `;
        }

        async function showAcceptedUI(driverId) {
        document.getElementById('map').classList.add('full-screen-map');

            const driverSnapshot = await database.ref(`drives/${driverId}`).once('value');
           const driverData = driverSnapshot.val();
        document.getElementById('map').classList.add('full-screen-map');

         document.getElementById('persistentNotification').style.display = 'block';
         document.getElementById('tripStatusContent').innerHTML = `
           <h3>ØªÙ… Ù‚Ø¨ÙˆÙ„ Ø·Ù„Ø¨Ùƒ</h3>
            <p>Ø§Ø³Ù… Ø§Ù„Ø³Ø§Ø¦Ù‚: ${driverData.fullName}</p>
              <p>Ù…ÙˆØ¯ÙŠÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø©: ${driverData.carModel}</p>
           <p>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ: ${driverData.phoneNumber}</p>
           <div id="driverLiveLocation"></div>
          `;
    
           startTrackingDriver(driverId);
        }

        function showInProgressUI(tripData) {
		    document.getElementById('map').classList.add('full-screen-map');

            document.getElementById('persistentNotification').style.display = 'block';
           document.getElementById('tripStatusContent').innerHTML = `
            <h3>Ø§Ù„Ø±Ø­Ù„Ø© Ù‚ÙŠØ¯ Ø§Ù„ØªÙ‚Ø¯Ù…</h3>
            <p>Ø§Ù„Ù…Ø³Ø§ÙØ© Ø§Ù„Ù…Ù‚Ø·ÙˆØ¹Ø©: <span id="distanceTraveled">0</span> ÙƒÙ…</p>
            <p>Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: <span id="eta">--</span></p>
           `;
    
            updateTripProgress(tripData);
        }
		function showCanceledUI() {
            document.getElementById('persistentNotification').style.display = 'block';
           document.getElementById('tripStatusContent').innerHTML = `
            <h3 style="color: #ff4444;">ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø±Ø­Ù„Ø©</h3>
            <button class="btn" onclick="clearAll()">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
          `;
		  
        }

// Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ Ù„Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØµÙØ­Ø©
        window.addEventListener('beforeunload', async (e) => {
            if (currentTripId) {
            const tripRef = database.ref(`rides/${userId}/${currentTripId}`);
            await tripRef.update({ lastActive: firebase.database.ServerValue.TIMESTAMP });
            }
        });
		function cancelRestore() {
           localStorage.removeItem('currentTripId');
            location.reload();
        }

        async function setupAcceptedTripUI(tripData) {
  // Ø¥Ø®ÙØ§Ø¡ Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªØ­ÙƒÙ…
          document.querySelector('.control-panel').style.display = 'none';
          document.querySelector('.action-buttons').style.display = 'none';
  
  // Ø¹Ø±Ø¶ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø³Ø§Ø¦Ù‚
          const driverInfo = await getDriverInfo(tripData.driverId);
          document.getElementById('persistentNotification').style.display = 'block';
          document.getElementById('tripStatusContent').innerHTML = `
          <p>Ø§Ù„Ø­Ø§Ù„Ø©: ÙÙŠ Ø§Ù„Ø·Ø±ÙŠÙ‚ Ø¥Ù„ÙŠÙƒ</p>
          <p>Ø§Ù„Ø³Ø§Ø¦Ù‚: ${driverInfo.name}</p>
          <p>Ø§Ù„Ù…Ø³Ø§ÙØ© Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©: <span id="liveDistance">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«...</span></p>
           `;
  
  // Ø¨Ø¯Ø¡ ØªØªØ¨Ø¹ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø­ÙŠ
           startRealTimeTracking(tripData.driverId);
        }
		async function calculateRouteWithRetry(retries = 3) {
           try {
              let origin = document.getElementById('origin').value;
              const destination = document.getElementById('destination').value;

               const request = {
                 origin: currentLocationCoords || origin,
                 destination: destination,
                 travelMode: 'DRIVING'
                };
 
                const response = await directionsService.route(request);
            if (response.routes.length === 0) throw new Error('No routes found');
        
        // ... Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø¨Ù†Ø¬Ø§Ø­ ...
        
            } catch (error) {
                if (retries > 0) {
                console.log(`Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©... ${retries} Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ù…ØªØ¨Ù‚ÙŠØ©`);
                await new Promise(resolve => setTimeout(resolve, 1000));
                return calculateRouteWithRetry(retries - 1);
                 }
                 showNotification('ÙØ´Ù„ ÙÙŠ Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³Ø§Ø±: ' + error.message, true);
            }
        }
        function selectPayment(method, event) {
		    if (!event) return; // ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø­Ø¯Ø«

            selectedPayment = method;
    
            document.querySelectorAll('.payment-option').forEach(option => {
            option.classList.remove('selected');
           });
    
          event.currentTarget.classList.add('selected');
          document.getElementById('confirmBookingButton').style.display = 'block';
        event.currentTarget.classList.add('selected');

    // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ± Ù…Ø±Ø¦ÙŠ
          event.currentTarget.style.transform = 'scale(1.02)';
           
            event.currentTarget.style.transform = 'scale(1)';
           
        }
		async function moveTripToEnd(userId, tripId) {
              try {
            const rideRef = database.ref(`rides/${userId}/${tripId}`);
            const endRef = database.ref(`end/${userId}/${tripId}`);

        // Ù†Ù‚Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¹ Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø§Ù„ØªØ§Ø±ÙŠØ®
            const snapshot = await rideRef.once('value'); 
            const tripData = snapshot.val();
             tripData.endTimestamp = firebase.database.ServerValue.TIMESTAMP;

             await endRef.set(tripData);
             await rideRef.remove();
            } catch (error) {
            console.error('Error moving trip:', error);
           showNotification('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„Ø±Ø­Ù„Ø©', true);
            }
        }

        function handlePaymentDone() {
		    clearAll();
          const userId = localStorage.getItem('userId');
          const tripId = localStorage.getItem('currentTripId');

          if (!userId || !tripId) {
             showNotification('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø­Ù„Ø© Ù†Ø´Ø·Ø©', true);
              return;
           }

    // Ù†Ù‚Ù„ Ø§Ù„Ø±Ø­Ù„Ø© Ø¥Ù„Ù‰ Ù‚Ø³Ù… Ø§Ù„Ø±Ø­Ù„Ø§Øª Ø§Ù„Ù…Ù†ØªÙ‡ÙŠØ©
           moveTripToEnd(userId, tripId);

    // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ¹ÙŠÙŠÙ†
           const endNotification = document.getElementById('endNotification');
           if (endNotification) endNotification.remove();

           document.getElementById('map').style.display = 'block';
           document.querySelector('.control-panel').style.display = 'flex';
           document.querySelector('.action-buttons').style.display = 'flex';
           document.getElementById('routeInfo').style.display = 'block';

            clearAll();
           showNotification('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø±Ø­Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­');
        }
		async function restoreTripState() {
            const userId = localStorage.getItem('userId');
             const tripRef = database.ref(`rides/${userId}/${currentTripId}`);
            const snapshot = await tripRef.once('value');
            if (snapshot.exists()) {
            const tripData = snapshot.val();
            handleStatusChange(tripData.status, tripData);
            }
        }
		let liveLocationWatcher = null;
        function startLiveLocationTracking(endLocation) {
            if (liveLocationWatcher) {
            navigator.geolocation.clearWatch(liveLocationWatcher);
            }

             liveLocationWatcher = navigator.geolocation.watchPosition(
            position => {
               const currentPos = {
                  lat: position.coords.latitude,
                  lng: position.coords.longitude
                };
            
                 updateLiveRoute(currentPos, endLocation);
            },
            error => {
               console.error('Error getting live location:', error);
            },
            {
              enableHighAccuracy: true,
              maximumAge: 30000,
              timeout: 2700
            }

            );
        }

// Ø¯Ø§Ù„Ø© Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ø­ÙŠ
        function updateLiveRoute(startPos, endPos) {
           directionsRenderer.setMap(null);
    
          const request = {
           origin: startPos,
          destination: endPos,
          travelMode: 'DRIVING',
          provideRouteAlternatives: false
          };

           directionsService.route(request, (response, status) => {
            if (status === 'OK') {
              directionsRenderer.setOptions({
                polylineOptions: {
                    strokeColor: "#00FF00",
                    strokeOpacity: 0.8,
                    strokeWeight: 6
                 }
                });
              directionsRenderer.setMap(map);
              directionsRenderer.setDirections(response);
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª
              startMarker.setPosition(startPos);
              startMarker.setMap(map);
              endMarker.setPosition(endPos);
              endMarker.setMap(map);
            
              map.fitBounds(response.routes[0].bounds);
              }
            });
        }
		// Ø¯Ø§Ù„Ø© Ù„ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø´Ø¨Ø­ÙŠØ© Ù…Ù† Ø§Ù„Ø®Ø±ÙŠØ·Ø©
function cleanGhostMapElements() {
    // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„ØµÙˆØ± ØºÙŠØ± Ø§Ù„Ù…Ø±ØºÙˆØ¨ ÙÙŠÙ‡Ø§
    const ghostImages = document.querySelectorAll('img[src="https://maps.gstatic.com/mapfiles/transparent.png"]');
    
    // Ø­Ø°Ù ÙƒÙ„ Ø§Ù„ØµÙˆØ± Ø§Ù„Ù…Ø·Ø§Ø¨Ù‚Ø©
    ghostImages.forEach(img => {
        img.parentNode.removeChild(img);
    });

    // ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©
    
}
		function openGoogleMapsNavigation(start, end) {
           const baseUrl = "https://www.google.com/maps/dir/?api=1";
            const params = new URLSearchParams({
            origin: `${start.lat},${start.lng}`,
            destination: `${end.lat},${end.lng}`,
            travelmode: "driving"
           });
            window.open(`${baseUrl}&${params.toString()}`, '_blank');
        }
		function cleanRouteMemory() {
    if(window.directionsService) {
        directionsService = null;
    }
    
    if(window.driverDirectionsRenderer) {
        driverDirectionsRenderer.setMap(null);
        driverDirectionsRenderer = null;
    }
    
    google.maps.event.clearInstanceListeners(map);
}

        function clearAll() {
		  // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù‚ÙŠÙ… Ù…Ù† localStorage Ø£ÙˆÙ„Ø§Ù‹
  const userId = localStorage.getItem('userId');
  const currentTripId = localStorage.getItem('currentTripId');
		    cleanRouteMemory();
    // Ø¥ÙŠÙ‚Ø§Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªÙ…Ø¹ÙŠÙ†
    if (tripListener) {
        database.ref(`rides/${userId}/${currentTripId}`).off('value', tripListener);
    }
    if (driverLocationListener) {
        database.ref(`drives/${driverId}/location`).off('value', driverLocationListener);
    }

    // Ù…Ø³Ø­ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ù…Ù† Ø§Ù„Ø®Ø±ÙŠØ·Ø©
    [directionsRenderer, driverDirectionsRenderer, driverRoutePolyline].forEach(item => {
        if (item) item.setMap(null);
    });

    [startMarker, endMarker, driverMarker].forEach(marker => {
        if (marker) marker.setMap(null);
    });

		  // Ø¥Ø²Ø§Ù„Ø© Ù…Ø³Ø§Ø± Ø§Ù„Ø³Ø§Ø¦Ù‚
	
    if(driverDirectionsRenderer) {
        driverDirectionsRenderer.setMap(null);
        driverDirectionsRenderer = null;
    }
    
    // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø®Ø·ÙˆØ· Ø§Ù„Ù…Ø±Ø³ÙˆÙ…Ø©
    if(driverRoutePolyline) {
        driverRoutePolyline.setMap(null);
        driverRoutePolyline = null;
    }
    
    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¹Ø§Ø±Ø¶ Ø§Ù„Ø§ØªØ¬Ø§Ù‡Ø§Øª
    if(directionsRenderer) {
        directionsRenderer.setMap(null);
        directionsRenderer = null;
    }
        const mapElement = document.getElementById('map');
		 document.querySelector('.profile-btn').style.display = 'block';
    const tripId = localStorage.getItem('currentTripId');
    
    // Ø­Ø°Ù Ø§Ù„Ø±Ø­Ù„Ø© Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙˆØ¬ÙˆØ¯Ø©
    if (userId && tripId) {
        const tripRef = database.ref(`rides/${userId}/${tripId}`);
        tripRef.remove()
            .then(() => {
                console.log('Trip deleted successfully');
                showNotification('ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø±Ø­Ù„Ø© Ø¨Ù†Ø¬Ø§Ø­');
            })
            .catch((error) => {
                console.error('Error deleting trip:', error);
                showNotification('ÙØ´Ù„ ÙÙŠ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø±Ø­Ù„Ø©', true);
            });
    }
    // Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ©
    mapElement.classList.remove('full-screen-map');
    mapElement.style.height = originalMapState.height;
    mapElement.style.width = originalMapState.width;
    mapElement.style.margin = originalMapState.margin;
    mapElement.style.borderRadius = originalMapState.borderRadius;
    mapElement.style.position = originalMapState.position;
    mapElement.style.top = originalMapState.top;
    mapElement.style.left = originalMapState.left;
    
    // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù…Ø±Ø¦ÙŠØ©
    document.getElementById('priceButton').style.display = 'block';
    document.querySelectorAll('.input-field').forEach(field => {
        field.style.display = 'block';
    });
    
    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø®Ø±ÙŠØ·Ø©
    if (map) {
        map.setCenter(new google.maps.LatLng(30.0444, 31.2357));
        map.setZoom(15);
    }
    // Ø¥Ø²Ø§Ù„Ø© Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ø³Ø§Ø¦Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙˆØ¬ÙˆØ¯Ø©
    if (driverMarker) {
        driverMarker.setMap(null);
        driverMarker = null;
    }
	    cleanGhostMapElements();
        driverMarker = null;
    driverDirectionsRenderer = null;
    // Ù…Ø³Ø­ Ø£ÙŠ Ù…Ø³Ø§Ø±Ø§Øª Ù…ØªØ¨Ù‚ÙŠØ©
    if (driverRoutePolyline) {
        driverRoutePolyline.setMap(null);
        driverRoutePolyline = null;
    }
    // Ø¥Ø²Ø§Ù„Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ù…Ù† Ø§Ù„Ø®Ø±ÙŠØ·Ø©
	    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø¹Ù†Ø§ØµØ± Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
             document.querySelector('.control-panel').style.display = 'flex';
             document.querySelector('.action-buttons').style.display = 'flex';
             document.getElementById('routeInfo').style.display = 'block';
             if (driverDirectionsRenderer) driverDirectionsRenderer.setMap(null);
             if (directionsRenderer) directionsRenderer.setMap(null);
             if (startMarker) startMarker.setMap(null);
             if (endMarker) endMarker.setMap(null);
             if (currentLocationMarker) currentLocationMarker.setMap(null);
             if (driverRoutePolyline) driverRoutePolyline.setMap(null);
             if (driverMarker) driverMarker.setMap(null);
             if (destinationMarker) destinationMarker.setMap(null);
               if(directionsRenderer) directionsRenderer.setMap(null);
			 driverMarker = null;
             destinationMarker = null;
    // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
             document.getElementById('persistentNotification').style.display = 'none';
             document.getElementById('routeInfo').innerHTML = '';
             document.getElementById('priceOptions').style.display = 'none';
             document.getElementById('bookingDetails').style.display = 'none';
             localStorage.removeItem('currentTripId');
    // Ø¥Ø¹Ø§Ø¯Ø© Ø¹Ø±Ø¶ Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„
               document.querySelectorAll('.input-field').forEach(field => {
                  field.style.display = 'block'; // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¹Ø±Ø¶
                })
				    document.getElementById('origin').parentNode.style.display = 'block';
                    document.getElementById('destination').parentNode.style.display = 'block';
    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù‚ÙŠÙ…
	    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„Ø£ØµÙ„ÙŠØ©
    startMarker.setPosition(null);
    endMarker.setPosition(null);
             selectedVehicle = null;
             currentLocationCoords = null;
        if (driverDirectionsRenderer) {
        driverDirectionsRenderer.setMap(null);
        driverDirectionsRenderer = null;
    }
    // Ø¥Ø²Ø§Ù„Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ù‚ÙˆÙ„
             document.getElementById('origin').value = '';
             document.getElementById('destination').value = '';
    
     // Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª
            if (tripListener) database.ref(`rides/${currentTripId}`).off('value', tripListener);
            if (driverLocationListener) database.ref(`drives/${driverId}/location`).off('value', driverLocationListener);
            const notification = document.getElementById('arrivalNotification');
            if (notification) {
               notification.style.display = 'none';
               notification.classList.remove('success');
            }
		       localStorage.removeItem('currentTripId');

        // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø¸Ø§Ù‡Ø±Ø©
            const endNotification = document.getElementById('endNotification');
            if (endNotification) {
                endNotification.remove();
            }
		    if(map) {
             map.setZoom(15);
            map.setCenter({ lat: 30.0444, lng: 31.2357 });
            }
    // Ø¥ÙŠÙ‚Ø§Ù Ø£ÙŠ Ø£ØµÙˆØ§Øª
            const sound = document.getElementById('notificationSound');
            if (sound) {
                sound.pause();
                sound.currentTime = 0;
            }
    	    if (liveLocationWatcher) {
           navigator.geolocation.clearWatch(liveLocationWatcher);
          liveLocationWatcher = null;
           }
          location.reload();
	
	}

        function getVehicleName(type) {
            const vehicles = {
                normal: 'Ø³ÙŠØ§Ø±Ø© Ø¹Ø§Ø¯ÙŠØ©',
                luxury: 'Ø³ÙŠØ§Ø±Ø© ÙØ§Ø®Ø±Ø©',
                helicopter: 'Ø·Ø§Ø¦Ø±Ø©'
            };
            return vehicles[type] || '';
        }

        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'flex' : 'none';
        }

        function showNotification(message, isError = false) {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.style.background = isError ? '#ff4444' : '#00CED1';
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => notification.remove(), 5000);
        }
		function adjustMarkersPosition(startPos, endPos) {
    const bounds = new google.maps.LatLngBounds();
    bounds.extend(startPos);
    bounds.extend(endPos);
    
    const ne = bounds.getNorthEast();
    const sw = bounds.getSouthWest();
    
    const padding = 0.0002; // ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¨Ù…Ù‚Ø¯Ø§Ø± 20 Ù…ØªØ± ØªÙ‚Ø±ÙŠØ¨Ù‹Ø§
    
    startMarker.setPosition(new google.maps.LatLng(
        startPos.lat() + padding,
        startPos.lng() - padding
    ));
    
    endMarker.setPosition(new google.maps.LatLng(
        endPos.lat() - padding,
        endPos.lng() + padding
    ));
}
// Ù…ØªØºÙŠØ± Ù„Ø­ÙØ¸ Ø§Ù„Ù…Ø±Ø¨Ø¹Ø§Øª Ø¹Ù„Ø´Ø§Ù† Ù†Ù‚Ø¯Ø± Ù†Ù…Ø³Ø­Ù‡Ù… Ø¨Ø¹Ø¯ÙŠÙ†
let tripAreas = [];
const hexGridSize = 0.006; // ØªØ¨Ø§Ø¹Ø¯ Ø§Ù„Ù…Ø±Ø§ÙƒØ² (Ø­Ø³Ø¨ Ù†ØµÙ Ø§Ù„Ù‚Ø·Ø± Ø§Ù„Ù…Ø·Ù„ÙˆØ¨)
const hexRadius = 0.0029; // Ù†ØµÙ Ø§Ù„Ù‚Ø·Ø± Ø§Ù„Ù…Ù†Ø§Ø³Ø¨ Ù„Ù„ØªØ¨Ø§Ø¹Ø¯

let tripHexagons = [];
const densityColors = {
    low: '#FFD580',    // 1-3 Ø±Ø­Ù„Ø§Øª
    medium: '#FFA500',  // 4-6 Ø±Ø­Ù„Ø§Øª
    high: '#FF4500'     // 7+ Ø±Ø­Ù„Ø§Øª
};

async function drawTripHotspots() {
    tripHexagons.forEach(hex => hex.setMap(null));
    tripHexagons = [];
    
    const ridesRef = database.ref('rides');
    const snapshot = await ridesRef.once('value');
    const areas = new Map();

    // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø¨ÙƒØ© Ø§Ù„Ø³Ø¯Ø§Ø³ÙŠØ©
    const getGridKey = (lat, lng) => {
        const gridLat = Math.round(lat / hexGridSize) * hexGridSize;
        const gridLng = Math.round(lng / hexGridSize) * hexGridSize;
        return `${gridLat},${gridLng}`;
    };

    snapshot.forEach(userSnapshot => {
        userSnapshot.forEach(tripSnapshot => {
            const trip = tripSnapshot.val();
            if (trip.startLocation) {
                const key = getGridKey(
                    trip.startLocation.lat,
                    trip.startLocation.lng
                );
                areas.set(key, (areas.get(key) || 0) + 1);
            }
        });
    });

    // Ø±Ø³Ù… Ø§Ù„Ø£Ø´ÙƒØ§Ù„ Ù…Ø¹ Ø¶Ù…Ø§Ù† Ø¹Ø¯Ù… Ø§Ù„ØªØ¯Ø§Ø®Ù„
    areas.forEach((count, key) => {
        const [lat, lng] = key.split(',');
        const hexagon = createHexagon(
            parseFloat(lat),
            parseFloat(lng),
            hexRadius, // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†ØµÙ Ø§Ù„Ù‚Ø·Ø± Ø§Ù„Ù…Ø¹Ø¯Ù„
            getDensityColor(count),
            count
        );
        tripHexagons.push(hexagon);
    });
}

function getDensityColor(count) {
    if (count <= 3) return densityColors.low;
    if (count <= 6) return densityColors.medium;
    return densityColors.high;
}
function createHexagon(lat, lng, radius, color, tripCount) {
    const center = { lat, lng };
    const coordinates = [];
    
    for (let i = 0; i < 6; i++) {
        const angle = (i * 60) * (Math.PI / 180);
        const dx = radius * Math.cos(angle);
        const dy = radius * Math.sin(angle);
        coordinates.push({ lat: lat + dy, lng: lng + dx });
    }
    coordinates.push(coordinates[0]);

    const hexagon = new google.maps.Polygon({
        paths: coordinates,
        strokeColor: color,
        strokeOpacity: 0.8,
        strokeWeight: 1,
        fillColor: color,
        fillOpacity: 0.3 + (tripCount * 0.05), // Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø´ÙØ§ÙÙŠØ© Ù…Ø¹ Ø§Ù„ÙƒØ«Ø§ÙØ©
        map: map,
        zIndex: 1,
        clickable: false

    });

    // Ø¥Ø¶Ø§ÙØ© ØªÙØ§Ø¹Ù„ÙŠØ© Ø¹Ù†Ø¯ Ø§Ù„hover
    hexagon.addListener('mouseover', () => {
        hexagon.setOptions({ 
            strokeWeight: 3,
            fillOpacity: 0.5 
        });
        new google.maps.InfoWindow({
            content: `Ø¹Ø¯Ø¯ Ø§Ù„Ø±Ø­Ù„Ø§Øª: ${tripCount}`
        }).open(map, hexagon);
    });

    hexagon.addListener('mouseout', () => {
        hexagon.setOptions({ 
            strokeWeight: 1,
            fillOpacity: 0.3 + (tripCount * 0.05)
        });
    });

    return hexagon;
}
// Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ Ù„Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ø§Ù„ÙÙˆØ±ÙŠØ©
database.ref('rides').on('value', () => {
    drawTripHotspots();
});
    </script>
</body>
</html>
